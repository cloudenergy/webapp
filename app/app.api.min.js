"use strict";angular.module("app").constant("APICONFIG",{auth:["auth",,{login:{},logout:{}}],account:["account",,{info:{},passwd:{},update:{},wxbind:{url:"wxaccount/bind"}}],bank:["bank",,{info:{}}],business:["business",,{monthlyusage:{},userinfo:{},monthlyaccountelectricusage:{},monthlysensordetail:{},energyconsumptioncost:{},energytimeline:{},sensorusage:{},channeldetail:{},recentchargelog:{},fundflow:{},timequantumstatistic:{},monitor:{}}],device:["device",,{type:{}}],sensor:["sensor",,{info:{}}],log:["log",,{charge:{}}],payment:["payment",,{charge:{},channelinfo:{}}],control:["control",,{send:{}}],channelaccount:["channelaccount",,{info:{},add:{},delete:{},verifycode:{}}],department:["department",,{update:{}}],baidu:["baidu",,{recentweathers:{method:"GET",headers:{apikey:"e84e1c883c721fe48ced18f3c2d40d3f"},url:"http://apis.baidu.com/apistore/weatherservice/recentweathers"},weather:{method:"JSONP",params:{ak:"1d86e3b5d994cd5f46514b7c3d1c1723",callback:"JSON_CALLBACK",output:"json"},url:location.protocol+"//api.map.baidu.com/telematics/v3/weather"},location:{method:"JSONP",params:{ak:"1d86e3b5d994cd5f46514b7c3d1c1723",callback:"JSON_CALLBACK",output:"json"},url:location.protocol+"//api.map.baidu.com/location/ip"}},{stripTrailingSlashes:!1}]}).config(["$httpProvider",function(e){e.interceptors.push(["$rootScope","$q","$location",function(e,a,t){return e.HttpRequestInProgress=0,{request:function(a){return e.HttpRequestInProgress++,a},requestError:function(e){return a.reject(e)},response:function(n){return e.HttpRequestInProgress--,angular.isObject(n.data)&&angular.isDefined(n.data.code)&&n.data.code?(90000005===n.data.code&&t.url("/m/logout").replace(),a.reject(n.data)):n},responseError:function(t){return e.HttpRequestInProgress--,a.reject(angular.isObject(t.data)?t.data:t)}}}])}]).service("$api",["$rootScope","$resource","$location","$state","APICONFIG",function(e,a,t,n,r){var o=function(e,a){return/(^http:\/\/)|(^https:\/\/)/.test(e)&&e||[localStorage.testapi&&"/testapi/"||"/api/",e,a&&"/:_api_action"||""].join("")},u=function(e){return angular.isArray(this)&&{parameters:!angular.isFunction(arguments[0])&&arguments[0]||void 0,postData:!angular.isFunction(arguments[1])&&arguments[1]||void 0}||{parameters:!angular.isFunction(e.parameters)&&e.parameters||void 0,postData:!angular.isFunction(e.postData)&&e.postData||void 0}},c=function(e){angular.forEach(n._api_request[e],function(e){e.request.$cancelRequest()}),delete n._api_request[e]};n._api_request={},e.$on("$stateChangeStart",function(e,a,t,n){a.name!==n.name&&c(n._api_url)}),e.$on("$stateChangeSuccess",function(e,a,n,r){t.url()!==r._api_url&&c(r._api_url)}),angular.forEach(r,function(e,r){angular.isArray(e)&&e[0]&&(e[0]=o(e[0],!!e[2]),e[3]=angular.extend({cancellable:!0},e[3]),angular.forEach(e[2],function(e,a){angular.extend(e,{url:e.url&&o(e.url)||void 0,method:e.method||"POST",params:angular.extend(e.url&&{}||{_api_action:a},e.params)})}),angular.forEach(this[r]=a.apply(a,e),function(e,a,o,c){this[a]=function(){return c=angular.isObject(arguments[0])&&arguments[0].cancellable,c&&delete arguments[0].cancellable,o=e.apply(this,arguments),o.$cancelRequest&&(n.current._api_url=t.url(),n._api_request[n.current._api_url]=n._api_request[n.current._api_url]||{},function(e,t){e&&(c||angular.equals(t,u.call({},e))?e.request.$resolved||(e.request.$cancelRequest(),!c&&console.warn("duplicate request:",localStorage.testapi&&"testapi"||"api","/",r,"/",a)):n._api_request[n.current._api_url][r+"_"+a+"_"+Date.now()]=e)}(n._api_request[n.current._api_url][r+"_"+a+"_recently"],u.apply([],arguments)),n._api_request[n.current._api_url][r+"_"+a+"_recently"]=angular.extend({request:o},u.apply([],arguments))),o}},this[r]))},this)}]);