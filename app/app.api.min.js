"use strict";angular.module("app").constant("APICONFIG",{auth:["auth",,{login:{},logout:{}}],account:["account",,{info:{},passwd:{},wxbind:{url:"wxaccount/bind"}}],business:["business",,{userinfo:{},recentchargelog:{},fundflow:{}}],character:["character",,{info:{}}],device:["device",,{type:{}}],sensor:["sensor",,{info:{}}],payment:["payment",,{channelinfo:{},charge:{}}],control:["control",,{send:{}}],department:["department",,{update:{}}]}).config(["$httpProvider",function(e){e.interceptors.push(["$rootScope","$q","$location",function(e,t,a){return e.HttpRequestInProgress=0,{request:function(t){return e.HttpRequestInProgress++,t},requestError:function(e){return t.reject(e)},response:function(r){return e.HttpRequestInProgress--,angular.isObject(r.data)&&angular.isDefined(r.data.code)&&r.data.code?(/90000005|90000007/.test(r.data.code)&&a.url("/m/logout").replace(),t.reject(r.data)):r},responseError:function(a){return e.HttpRequestInProgress--,t.reject(angular.isObject(a.data)?a.data:a)}}}])}]).service("$api",["$rootScope","$resource","$location","$state","APICONFIG",function(e,t,a,r,n){var u=function(e,t){return/(^http:\/\/)|(^https:\/\/)/.test(e)&&e||[localStorage.testapi&&"/testapi/"||"/api/",e,t&&"/:_api_action"||""].join("")},o=function(e){return angular.isArray(this)&&{parameters:!angular.isFunction(arguments[0])&&arguments[0]||void 0,postData:!angular.isFunction(arguments[1])&&arguments[1]||void 0}||{parameters:!angular.isFunction(e.parameters)&&e.parameters||void 0,postData:!angular.isFunction(e.postData)&&e.postData||void 0}},s=function(e){angular.forEach(r._api_request[e],function(e){e.request.$cancelRequest()}),delete r._api_request[e]};r._api_request={},e.$on("$stateChangeStart",function(e,t,a,r){t.name!==r.name&&s(r._api_url)}),e.$on("$stateChangeSuccess",function(e,t,r,n){a.url()!==n._api_url&&s(n._api_url)}),angular.forEach(n,function(e,n){angular.isArray(e)&&e[0]&&(e[0]=u(e[0],!!e[2]),e[3]=angular.extend({cancellable:!0},e[3]),angular.forEach(e[2],function(e,t){angular.extend(e,{url:e.url&&u(e.url)||void 0,method:e.method||"POST",params:angular.extend(e.url&&{}||{_api_action:t},e.params)})}),angular.forEach(this[n]=t.apply(t,e),function(e,t,u,s){this[t]=function(){return s=angular.isObject(arguments[0])&&arguments[0].cancellable,s&&delete arguments[0].cancellable,u=e.apply(this,arguments),u.$cancelRequest&&(r.current._api_url=a.url(),r._api_request[r.current._api_url]=r._api_request[r.current._api_url]||{},function(e,a){e&&(s||angular.equals(a,o.call({},e))?e.request.$resolved||(e.request.$cancelRequest(),!s&&console.warn("duplicate request:",localStorage.testapi&&"testapi"||"api","/",n,"/",t)):r._api_request[r.current._api_url][n+"_"+t+"_"+Date.now()]=e)}(r._api_request[r.current._api_url][n+"_"+t+"_recently"],o.apply([],arguments)),r._api_request[r.current._api_url][n+"_"+t+"_recently"]=angular.extend({request:u},o.apply([],arguments))),u}},this[n]))},this)}]);