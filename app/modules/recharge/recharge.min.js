"use strict";angular.module("app").controller("app.recharge",["$scope","$q","$ionicLoading","$api","User","ERRORCODE",function(e,n,a,r,i,t){var o=this;(o.refresh=function(a,t){return n.all([i.$userinfo({_inprogress:a}).then(function(){o.UserData=i.data}),t!==!1&&r.payment.channelinfo({_inprogress:a,project:i.data.project,type:{APP_ANDROID:["alipay","wx"],APP_IOS:["alipay","wx"],WEB:["alipay_pc_direct","alipay_qr","alipay_wap","wx_pub_qr","wx_wap"],WECHAT:["wx_pub"]}[i.client],flow:"EARNING"},function(e){o.channels=e.result,o.recharge.channel=o.recharge.channel||o.channels[0]&&o.channels[0].id||void 0}).$promise]).finally(function(){angular.isDefined(a)&&e.$broadcast("scroll.refreshComplete")})})(),angular.extend(o,{amount_min:100,amounts:[100,500,1e3,2e3,5e3],recharge:{amount:100},submit:function(e){if(e.amount.$error.required)return a.show({template:'<i class="ion-android-alert"></i> 请输入充值金额',duration:1e3});if(e.amount.$error.min)return a.show({template:'<i class="ion-android-alert"></i> 最低充值'+o.amount_min+"元",duration:1e3});var c=[],l=n.defer();if(!o.recharge.amount&&c.push("请输入正确的金额"),!o.recharge.channel&&c.push("暂无可用充值渠道"),c.length)return a.show({template:'<i class="ion-android-alert"></i> '+c.join("，"),duration:1e3});r.payment.charge({project:i.data.project,body:"智慧管家充值",subject:"智慧管家",uid:i.data.uid,amount:o.recharge.amount,channelaccountid:o.recharge.channel},function(e){window.pingpp?window.pingpp.createPayment(e.result,function(e){/WEB|WECHAT/.test(i.client)?"success"===e?l.resolve():l.reject(e||"invalid"):l.resolve()},function(e){l.reject(e||"invalid")}):a.show({template:'<i class="ion-alert-circled"></i> 请在手机APP或微信中进行充值',duration:2e3})},function(e){l.reject(e.message)}),l.promise.then(function(){o.refresh(void 0,!1).then(function(){a.show({template:'<i class="ion-ios-checkmark"></i> 充值成功',duration:1500})})},function(e){a.show({template:'<i class="ion-alert-circled"></i> '+(t["pingpp_"+e]||e||"充值失败"),duration:2e3})})}})}]);