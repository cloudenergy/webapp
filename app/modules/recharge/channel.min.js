"use strict";angular.module("app").controller("app.recharge_channel",["$scope","$q","$timeout","$ionicLoading","$ionicHistory","$state","$stateParams","$api","User","ERRORCODE",function(e,n,o,t,c,r,a,s,p,l){var u=this;u.amount=a.amount,u.channelChecked=void 0,e.$on("$ionicView.beforeEnter",function(){u.refresh()}),u.refresh=function(n){return s.payment.channelinfo({_inprogress:n,project:p.data.project,type:window.isWECHAT&&["wx_pub"]||(window.isAndroid||window.isIOS)&&["alipay","wx"]||["alipay_pc_direct","alipay_qr","alipay_wap","wx_pub_qr","wx_wap"],flow:"EARNING",app:window.isWECHAT?void 0:"ZFT"},function(n){u.channels=n.result,angular.forEach(u.channels,function(n){n.icon="icon-app icon-"+(/^alipay/.test(n.type)?"alipay calm":"wechat balanced")}),u.channelChecked=u.channelChecked||u.channels[0]&&u.channels[0].id||void 0}).$promise.finally(function(){angular.isDefined(n)&&e.$broadcast("scroll.refreshComplete")})},u.submit=function e(){if(!u.amount)return r.go("app.recharge");if(!u.channelChecked)return t.show({template:'<i class="ion-android-alert"></i> 未开通支付功能',duration:2e3});var a=n.defer(),i=window.pingpp||window.Pingpp;i?(u.submit=angular.noop,s.payment.charge({project:p.data.project,body:"租付通",subject:window.isWECHAT?"账户充值":"租付通-账户充值",uid:p.data.uid,amount:u.amount,channelaccountid:u.channelChecked},function(n){u.submit=e,i.createPayment(n.result,function(n,e){"success"===n?a.resolve():a.reject(l["pingpp_"+n])})},function(n){u.submit=e,a.reject(n.message)})):a.reject("请在手机APP或微信中充值"),a.promise.then(function(){t.show({template:'<i class="ion-ios-checkmark"></i> 充值成功',duration:2e3}),o(function(){c.goBack()},1500)},function(n){t.show({template:'<i class="ion-alert-circled"></i> '+(n||"充值失败"),duration:3e3})})}}]);