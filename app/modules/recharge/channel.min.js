"use strict";angular.module("app").controller("app.recharge_channel",["$scope","$q","$ionicLoading","$stateParams","$api","User","ERRORCODE",function(e,n,a,i,c,t,o){var r=this;r.amount=i.amount,r.channelChecked=void 0,(r.refresh=function(n){return c.payment.channelinfo({_inprogress:n,project:t.data.project,type:{ANDROID:["alipay","wx"],IOS:["alipay","wx"],WEB:["alipay_pc_direct","alipay_qr","alipay_wap","wx_pub_qr","wx_wap"],WECHAT:["wx_pub"]}[t.client],flow:"EARNING"},function(e){r.channels=e.result,angular.forEach(r.channels,function(e){e.icon="icon-app icon-"+(/^alipay/.test(e.type)?"alipay calm":"wechat balanced")}),r.channelChecked=r.channelChecked||r.channels[0]&&r.channels[0].id||void 0}).$promise.finally(function(){angular.isDefined(n)&&e.$broadcast("scroll.refreshComplete")})})(),r.submit=function(e){var i=[],p=n.defer();if(!r.recharge.amount&&i.push("请输入正确的金额"),!r.recharge.channel&&i.push("暂无可用充值渠道"),i.length)return a.show({template:'<i class="ion-android-alert"></i> '+i.join("，"),duration:1e3});window.pingpp=window.pingpp||window.Pingpp,window.pingpp?c.payment.charge({project:t.data.project,body:"智慧管家充值",subject:"智慧管家",uid:t.data.uid,amount:r.recharge.amount,channelaccountid:r.recharge.channel},function(e){window.pingpp.createPayment(e.result,function(e){"success"===e?p.resolve():p.reject(o["pingpp_"+e])})},function(e){p.reject(e.message)}):p.reject("请在手机APP或微信中充值"),p.promise.then(function(){r.refresh(void 0,!1).then(function(){a.show({template:'<i class="ion-ios-checkmark"></i> 充值成功',duration:1500})})},function(e){a.show({template:'<i class="ion-alert-circled"></i> '+(e||"充值失败"),duration:2e3})})}}]);