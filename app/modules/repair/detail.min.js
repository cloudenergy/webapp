"use strict";angular.module("app").controller("app.repair_detail",["$scope","$q","$http","$timeout","$stateParams","$ionicLoading","$ionicActionSheet","$api","User","Upload","base64",function(e,n,i,t,a,o,r,c,u,d,l){var s=this;window.isAndroid&&(e.$on("$ionicView.enter",function(){window.DO_NOT_RELOAD=!0}),e.$on("$ionicView.leave",function(){delete window.DO_NOT_RELOAD})),angular.extend(s,{id:a.id||void 0,isPRODUCTION:window.isPRODUCTION,content:{repairName:"",repairPlace:"",repairContent:"",repairPerson:"",repairPhone:"",repairImgs:[]},ImgPreview:[],ImgDelete:function(e){s.ImgPreview.splice(e,1)},AppPicker:function(){window.ImagePicker.getPictures(function(e){angular.forEach(e,function(e){d.urlToBlob(e).then(function(n){var i=new FileReader;i.onloadend=function(n){t(function(){s.ImgPreview.push({name:(new Date).getTime()+"."+/[^\.]+$/.exec(e)[0],data:n.target.result})})},i.readAsDataURL(n)})})},function(){o.show({template:'<i class="ion-android-alert"></i> 无法打开相册',duration:2e3})},{maximumImagesCount:3-s.ImgPreview.length,width:1920,height:1440,quality:80})},H5ImgSelected:[],H5Picker:function(){angular.forEach(s.H5ImgSelected,function(e){angular.isUndefined(e.$upload)&&(e.$upload=1,d.base64DataUrl(e).then(function(n){s.ImgPreview.push({name:(new Date).getTime()+"."+/[^\.]+$/.exec(e.name)[0],data:n})}))})},upload:function(e){var i=n.defer();return c.interaction.uploadtoken({file:e.name},function(n){c.qiniu.upload({base64:l.encode(n.result.file),token:n.result.token},{file:e.data.split(";base64,")[1]},function(n){s.content.repairImgs.push({key:n.key,name:e.name}),i.resolve(e)},i.reject)},i.reject),i.promise},info:function(){},submit:function(){c.workorder.add({from:u.data.uid,content:s.content,project:u.data.project,type:1081},function(){})}})}]);