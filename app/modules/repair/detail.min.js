"use strict";angular.module("app").controller("app.repair_detail",["$scope","$q","$timeout","$stateParams","$ionicLoading","$api","User","Upload","base64",function(e,n,i,t,a,o,r,c,u){var d=this;window.isAndroid&&(e.$on("$ionicView.enter",function(){window.DO_NOT_RELOAD=!0}),e.$on("$ionicView.leave",function(){delete window.DO_NOT_RELOAD})),angular.extend(d,{id:t.id||void 0,isPRODUCTION:window.isPRODUCTION,content:{repairName:"",repairPlace:"",repairContent:"",repairPerson:"",repairPhone:"",repairImgs:[]},ImgPreview:[],ImgDelete:function(e){d.ImgPreview.splice(e,1)},AppPicker:function(){window.ImagePicker.getPictures(function(e){angular.forEach(e,function(e){window.plugins.Base64.encodeFile(e,function(n){i(function(){d.ImgPreview.push({name:(new Date).getTime()+"."+/[^\.]+$/.exec(e)[0],data:n})})})})},function(){a.show({template:'<i class="ion-android-alert"></i> 无法打开相册',duration:2e3})},{maximumImagesCount:3-d.ImgPreview.length,width:1920,height:1440,quality:80})},H5ImgSelected:[],H5Picker:function(){angular.forEach(d.H5ImgSelected,function(e){angular.isUndefined(e.$upload)&&(e.$upload=1,c.base64DataUrl(e).then(function(n){d.ImgPreview.push({name:(new Date).getTime()+"."+/[^\.]+$/.exec(e.name)[0],data:n})}))})},upload:function(e){var i=n.defer();return o.interaction.uploadtoken({file:e.name},function(n){o.qiniu.upload({base64:u.encode(n.result.file),token:n.result.token},{file:e.data.split(";base64,")[1]},function(n){d.content.repairImgs.push({key:n.key,name:e.name}),i.resolve(e)},i.reject)},i.reject),i.promise},info:function(){},submit:function(){o.workorder.add({from:r.data.uid,content:d.content,project:r.data.project,type:1081},function(){})}})}]);