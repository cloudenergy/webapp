"use strict";angular.module("app").controller("app.repair_detail",["$scope","$q","$http","$timeout","$stateParams","$ionicLoading","$ionicActionSheet","$api","User","Upload","base64",function(e,t,n,a,i,o,r,c,u,d,l){var s=this;window.isAndroid&&(e.$on("$ionicView.enter",function(){window.DO_NOT_RELOAD=!0}),e.$on("$ionicView.leave",function(){delete window.DO_NOT_RELOAD})),angular.extend(s,{id:i.id||void 0,isPRODUCTION:window.isPRODUCTION,content:{repairName:"",repairPlace:"",repairContent:"",repairPerson:"",repairPhone:"",repairImgs:[]},ImgPreview:[],ImgDelete:function(e){s.ImgPreview.splice(e,1)},AppPicker:function(){window.ImagePicker.getPictures(function(e){angular.forEach(e,function(i){d.urlToBlob(i).then(function(e){var n=new FileReader;n.onloadend=function(e){a(function(){s.ImgPreview.push({name:(new Date).getTime()+"."+/[^\.]+$/.exec(i)[0],data:e.target.result})})},n.readAsDataURL(e)})})},function(){o.show({template:'<i class="ion-android-alert"></i> 无法打开相册',duration:2e3})},{maximumImagesCount:3-s.ImgPreview.length,width:1920,height:1440,quality:80})},H5ImgSelected:[],H5Picker:function(){angular.forEach(s.H5ImgSelected,function(n){angular.isUndefined(n.$upload)&&(n.$upload=1,d.base64DataUrl(n).then(function(e){s.ImgPreview.push({name:(new Date).getTime()+"."+/[^\.]+$/.exec(n.name)[0],data:e})}))})},upload:function(n){var i=t.defer();return c.interaction.uploadtoken({file:n.name},function(e){c.qiniu.upload({base64:l.encode(e.result.file),token:e.result.token},{file:n.data.split(";base64,")[1]},function(e){s.content.repairImgs.push({key:e.key,name:n.name}),i.resolve(n)},i.reject)},i.reject),i.promise},info:function(){},submit:function(){c.workorder.add({from:u.data.uid,content:s.content,project:u.data.project,type:1081},function(){})}})}]);