"use strict";angular.module("app").controller("app.repair_detail",["$scope","$q","$timeout","$stateParams","$ionicLoading","$api","User","Upload","base64",function(e,n,a,t,i,o,r,u,d){var c=this;window.isAndroid&&(e.$on("$ionicView.enter",function(){window.STOP_RESUME=!0}),e.$on("$ionicView.leave",function(){delete window.STOP_RESUME})),angular.extend(c,{id:t.id||void 0,isPRODUCTION:window.isPRODUCTION,content:{repairName:"",repairPlace:"",repairContent:"",repairPerson:"",repairPhone:"",repairImgs:[]},statusbar:{hide:window.StatusBar&&StatusBar.hide||angular.noop,show:window.StatusBar&&StatusBar.show||angular.noop},ImgPreview:[],AppPicker:function(){window.ImagePicker.getPictures(function(e){angular.forEach(e,function(e){u.urlToBlob(e).then(function(n){var t=new FileReader;t.onloadend=function(n){a(function(){c.ImgPreview.push({name:(new Date).getTime()+"."+/[^\.]+$/.exec(e)[0],data:n.target.result})})},t.readAsDataURL(n)})})},function(){i.show({template:'<i class="ion-android-alert"></i> 无法打开相册',duration:2e3})},{maximumImagesCount:3-c.ImgPreview.length,width:1920,height:1440,quality:80})},H5ImgSelected:[],H5Picker:function(){angular.forEach(c.H5ImgSelected,function(e){angular.isUndefined(e.$upload)&&(e.$upload=1,u.base64DataUrl(e).then(function(n){c.ImgPreview.push({name:(new Date).getTime()+"."+/[^\.]+$/.exec(e.name)[0],data:n})}))})},upload:function(e){var a=n.defer();return o.interaction.uploadtoken({file:e.name},function(n){o.qiniu.upload({base64:d.encode(n.result.file),token:n.result.token},{file:e.data.split(";base64,")[1]},function(n){c.content.repairImgs.push({key:n.key,name:e.name}),a.resolve(e)},a.reject)},a.reject),a.promise},info:function(){},submit:function(){o.workorder.add({from:r.data.uid,content:c.content,project:r.data.project,type:1081},function(){})}})}]);