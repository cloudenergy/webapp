"use strict";angular.module("app").controller("app.notification",["$scope","$timeout","$ionicPopover","$ionicPopup","$api","$message","User",function(e,t,i,n,o,l,s){var a=this,c={count:0,pageindex:0,pagesize:30};angular.extend(a,{selected:void 0,hold:function(e,t){a.selected=t,a.popover&&a.popover.show(e)},delete:function(){a.selected&&l.delete({id:a.selected.id}).then(function(){a.selected=void 0,a.popover.hide()})},deleteAll:function(){n.confirm({cssClass:"bg-stable text-center",title:"确认清空所有通知吗？",template:"清空后无法恢复！",cancelText:"取消",okText:"清空",okType:"button-assertive"}).then(function(e){e&&l.delete({all:1,uid:s.data.uid}).then(function(){a.list=[]})})},readedAll:function(){l.readed({all:1,uid:s.data.uid})},loadList:function(i){/refresher/.test(i)&&(c.count=0,c.pageindex=0),l.list({pageindex:c.pageindex+1,pagesize:c.pagesize}).then(function(e){/refresher/.test(i)&&a.list&&(a.list.length=0),c=e.result.paging,angular.forEach(e.result.detail,function(e){this.push(e)},a.list=a.list||[])},function(){a.list?a.list.length=0:a.list=[]}).finally(function(){/refresher/.test(i)&&e.$broadcast("scroll.refreshComplete"),/infinite/.test(i)&&e.$broadcast("scroll.infiniteScrollComplete"),a.infiniteDisable=!0,a.list&&a.list.length<c.count&&t(function(){delete a.infiniteDisable},16.66)})}}),e.$on("$ionicView.enter",function(){i.fromTemplateUrl("notification-popover-hold-menu.html",{scope:e}).then(function(e){a.popover=e}),a.loadList(),a.readedAll()}),e.$on("$ionicView.leave",function(){a.popover.remove()})}]);