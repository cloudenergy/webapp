"use strict";angular.module("app").controller("app.notification",["$scope","$timeout","$ionicPopover","$ionicPopup","$ionicScrollDelegate","$message","User",function(e,t,i,n,o,l,s){var c=this,r={count:0,pageindex:0,pagesize:30};angular.extend(c,{selected:void 0,selectedIndex:void 0,hold:function(e,t,i){c.selected=i,c.selectedIndex=t,c.popover&&c.popover.show(e)},delete:function(){c.selected&&l.delete({id:c.selected.id}).then(function(){c.popover.hide(),c.list.splice(c.selectedIndex,1),!c.list.length&&c.loadList("refresher"),c.selected=void 0,c.selectedIndex=void 0})},deleteAll:function(){n.confirm({cssClass:"bg-stable text-center",title:"确认清空所有通知吗？",template:"清空后无法恢复！",cancelText:"取消",okText:"清空",okType:"button-assertive"}).then(function(e){e&&l.delete({all:1,uid:s.data.uid}).then(function(){c.list=[]})})},readedAll:function(){l.readed({all:1,uid:s.data.uid})},loadList:function(i){/refresher/.test(i)&&(r.count=0,r.pageindex=0),l.list({pageindex:r.pageindex+1,pagesize:r.pagesize}).then(function(e){/refresher/.test(i)&&c.list&&(c.list.length=0),r=e.result.paging,angular.forEach(e.result.detail,function(e){this.push(e)},c.list=c.list||[])},function(){c.list?c.list.length=0:c.list=[]}).finally(function(){/refresher/.test(i)&&e.$broadcast("scroll.refreshComplete"),/infinite/.test(i)&&e.$broadcast("scroll.infiniteScrollComplete"),c.infiniteDisable=!0,c.list&&c.list.length<r.count&&t(function(){delete c.infiniteDisable},16.66)})}}),e.$on("app.notification:refresh",function(){o.scrollTop(),o.resize(),c.loadList("refresher")}),e.$on("$ionicView.enter",function(){i.fromTemplateUrl("notification-popover-hold-menu.html",{scope:e}).then(function(e){c.popover=e}),c.readedAll()}),e.$on("$ionicView.leave",function(){c.popover.remove()})}]);