"use strict";angular.module("app").controller("app.notification",["$scope","$timeout","$ionicPopover","$ionicPopup","$message","User",function(e,t,i,n,l,o){var s=this,c={count:0,pageindex:0,pagesize:30};angular.extend(s,{selected:void 0,selectedIndex:void 0,hold:function(e,t,i){s.selected=i,s.selectedIndex=t,s.popover&&s.popover.show(e)},delete:function(){s.selected&&l.delete({id:s.selected.id}).then(function(){s.popover.hide(),s.list.splice(s.selectedIndex,1),!s.list.length&&s.loadList("refresher"),s.selected=void 0,s.selectedIndex=void 0})},deleteAll:function(){n.confirm({cssClass:"bg-stable text-center",title:"确认清空所有通知吗？",template:"清空后无法恢复！",cancelText:"取消",okText:"清空",okType:"button-assertive"}).then(function(e){e&&l.delete({all:1,uid:o.data.uid}).then(function(){s.list=[]})})},readedAll:function(){l.readed({all:1,uid:o.data.uid})},loadList:function(i){/refresher/.test(i)&&(c.count=0,c.pageindex=0),l.list({pageindex:c.pageindex+1,pagesize:c.pagesize}).then(function(e){/refresher/.test(i)&&s.list&&(s.list.length=0),c=e.result.paging,angular.forEach(e.result.detail,function(e){this.push(e)},s.list=s.list||[])},function(){s.list?s.list.length=0:s.list=[]}).finally(function(){/refresher/.test(i)&&e.$broadcast("scroll.refreshComplete"),/infinite/.test(i)&&e.$broadcast("scroll.infiniteScrollComplete"),s.infiniteDisable=!0,s.list&&s.list.length<c.count&&t(function(){delete s.infiniteDisable},16.66)})}}),e.$on("$ionicView.enter",function(){i.fromTemplateUrl("notification-popover-hold-menu.html",{scope:e}).then(function(e){s.popover=e}),s.readedAll()}),e.$on("$ionicView.leave",function(){s.popover.remove()})}]);