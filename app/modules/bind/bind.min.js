"use strict";angular.module("app").controller("app.bind",["$location","$state","$stateParams","$ionicHistory","$ionicLoading","$api","User","ERRORCODE",function(e,i,t,o,a,n,s,r){this.submit=function(d){return d.user?d.password?(d.onsubmit=!0,void n.account.wxbind({uid:d.user,passwd:d.password,openid:t.openid,platformid:t.platformid},function(){s.$login({user:d.user,passwd:(new window.Hashes.MD5).hex(d.password).toUpperCase()}).then(function(){o.clearHistory(),o.clearCache().then(function(){t.target&&"/m/bind"!==decodeURIComponent(t.target)?e.url(t.target).replace():i.go("app.index",{},{location:"replace"})})},function(e){delete d.onsubmit,a.show({template:'<i class="ion-alert-circled"></i> '+(r[e.code]||e.message||"登录失败"),duration:2e3})})},function(e){delete d.onsubmit,a.show({template:'<i class="ion-alert-circled"></i> '+(r[e.code]||e.message||"绑定失败"),duration:2e3})})):a.show({template:'<i class="ion-android-alert"></i> 密码不能为空',duration:2e3}):a.show({template:'<i class="ion-android-alert"></i> 帐号不能为空',duration:2e3})}}]);