"use strict";angular.module("app").controller("app.bind",["$cookies","$location","$state","$stateParams","$ionicHistory","$ionicLoading","$api","User","ERRORCODE",function(e,t,o,i,a,n,s,r,d){this.submit=function(c){return c.user?c.password?(n.show({template:o.current.name,duration:2e3}),c.onsubmit=!0,void s.account.wxbind({uid:c.user,passwd:c.password,openid:i.openid||e.get("openid"),platformid:i.platformid||e.get("platformid")},function(){r.$login({user:c.user,passwd:(new window.Hashes.MD5).hex(c.password).toUpperCase()}).then(function(){delete c.onsubmit,a.clearHistory(),a.clearCache().then(function(){i.target&&"/m/bind"!==decodeURIComponent(i.target)?t.url(i.target).replace():o.go("app.index",{},{location:"replace"})})},function(e){delete c.onsubmit,n.show({template:'<i class="ion-alert-circled"></i> '+(d[e.code]||e.message||"登录失败"),duration:2e3})})},function(e){delete c.onsubmit,n.show({template:'<i class="ion-alert-circled"></i> '+(d[e.code]||e.message||"绑定失败"),duration:2e3})})):n.show({template:'<i class="ion-android-alert"></i> 密码不能为空',duration:2e3}):n.show({template:'<i class="ion-android-alert"></i> 帐号不能为空',duration:2e3})}}]);