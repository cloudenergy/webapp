"use strict";angular.module("app").component("addonCharge",{templateUrl:"app/modules/addon/charge/charge.html?rev=26efd185c8",controller:["$q","$state","$api","Dialog","User","ERRORCODE",function(e,t,n,a,c,i){var r=this;angular.extend(r,{$onInit:function(){r.UserData=c.data,r.charge.amount=r.amounts[0],n.payment.channelinfo({project:c.data.project,type:["alipay","wx"],flow:"EARNING"},function(e){r.channels=e.result||[],r.charge.channel=r.channels[0]&&r.channels[0].id||void 0})},amounts:[.01,100,500,1e3,2e3,5e3],charge:{},submit:function(t){var o=[],l=e.defer();return!r.charge.amount&&o.push("请输入正确的金额"),!r.charge.channel&&o.push("暂无可用充值渠道"),o.length?void a.alert({title:"信息不完整",textContent:o.join("，"),targetEvent:t}):(n.payment.charge({project:c.data.project,body:"智慧管家充值",subject:"智慧管家",uid:c.data.uid,amount:r.charge.amount,channelaccountid:r.charge.channel},function(e){pingpp.setAPURL("/libs/pingpp-js-2.1.5/alipay_in_weixin/pay.htm"),pingpp.createPayment(e.result,function(e){"success"===e?l.resolve(111):l.reject(222+(e||"invalid"))},function(e){l.reject(333+(e||"invalid"))})},function(e){l.reject(444+e.message)}),void l.promise.then(function(){a.alert({title:"充值成功",targetEvent:t})},function(e){a.alert({title:"充值未成功",textContent:i["pingpp_"+e]||e,targetEvent:t})}))}})}]});