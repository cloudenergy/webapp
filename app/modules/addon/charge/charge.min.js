"use strict";angular.module("app").component("addonCharge",{templateUrl:"app/modules/addon/charge/charge.html?rev=952305be87",controller:["$state","$api","Dialog","User",function(e,n,t,a){var o=this;angular.extend(o,{$onInit:function(){o.UserData=a.data,o.charge.amount=o.amounts[0],n.payment.channelinfo({project:a.data.project,type:["wx_pub"],flow:"EARNING"},function(e){o.channels=e.result||[],o.charge.channel=o.channels[0]&&o.channels[0].id||void 0})},amounts:[.01,100,500,1e3,2e3,5e3],charge:{},submit:function(e){var c=[];return!o.charge.amount&&c.push("请输入正确的金额"),!o.charge.channel&&c.push("暂无可用充值渠道"),c.length?void t.alert({title:"信息不完整",textContent:c.join("，"),targetEvent:e}):void n.payment.charge({project:a.data.project,body:"智慧管家充值",subject:"智慧管家",uid:a.data.uid,amount:o.charge.amount,channelaccountid:o.charge.channel},function(n){if(window.pingpp&&sessionStorage.openid)window.pingpp.createPayment({order_no:n.result.order_no,app:{id:n.result.credential[o.charge.channel].appId},channel:n.result.channel,amount:n.result.amount,client_ip:n.result.client_ip,currency:n.result.currency,subject:n.result.subject,body:n.result.body,extra:{open_id:sessionStorage.openid}},function(n){console.log("result:",n,arguments),"success"==n||t.alert({title:"充值未成功",textContent:{fail:"支付失败",cancel:"用户已取消支付",invalid:"支付结果无效，请联系支付平台"}[n||"invalid"],targetEvent:e})},function(n){t.alert({title:"充值未成功",textContent:{fail:"支付失败",cancel:"用户已取消支付",invalid:"支付结果无效，请联系支付平台"}[n||"invalid"],targetEvent:e})});else if(window.wx&&sessionStorage.openid){!function(e,n){e.chooseWXPay({appId:n.appId,timeStamp:n.timeStamp,nonceStr:n.nonceStr,package:"prepay_id="+n.prepayId,signType:"MD5",paySign:n.sign,success:function(e){console.log("chooseWXPay:",e)}})}(window.wx,n.result.credential.wx)}},function(n){t.alert({title:"充值未成功",textContent:n.message,targetEvent:e})})}})}]});