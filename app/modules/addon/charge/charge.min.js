"use strict";angular.module("app").component("addonCharge",{templateUrl:"app/modules/addon/charge/charge.html?rev=952305be87",controller:["$state","$api","Dialog","User","ERRORCODE",function(e,t,n,a,o){var r=this;angular.extend(r,{$onInit:function(){r.UserData=a.data,r.charge.amount=r.amounts[0],t.payment.channelinfo({project:a.data.project,type:["wx"],flow:"EARNING"},function(e){r.channels=e.result||[],r.charge.channel=r.channels[0]&&r.channels[0].id||void 0})},amounts:[.02,100,500,1e3,2e3,5e3],charge:{},submit:function(e){var i=[];return!r.charge.amount&&i.push("请输入正确的金额"),!r.charge.channel&&i.push("暂无可用充值渠道"),i.length?void n.alert({title:"信息不完整",textContent:i.join("，"),targetEvent:e}):void t.payment.charge({project:a.data.project,body:"智慧管家充值",subject:"智慧管家",uid:a.data.uid,amount:r.charge.amount,channelaccountid:r.charge.channel},function(t){if(window.pingpp&&sessionStorage.openid)t.result.app={id:t.result.app},t.result.channel="wx_pub",t.result.credential.wx_pub=t.result.credential.wx,t.result.extra=t.result.extra||{},t.result.extra.open_id=sessionStorage.openid,n.alert({title:"测试test",textContent:t.result}),window.pingpp.createPayment(t.result,function(t){"success"===t?a.userinfo().then(function(e){r.UserData=e}):n.alert({title:"充值未成功",textContent:o["pingpp_"+(t||"invalid")],targetEvent:e})},function(t){n.alert({title:"充值未成功",textContent:o["pingpp_"+(t||"invalid")],targetEvent:e})});else if(window.wx&&sessionStorage.openid){!function(e,t){e.chooseWXPay({appId:t.appId,timeStamp:t.timeStamp,nonceStr:t.nonceStr,package:"prepay_id="+t.prepayId,signType:"MD5",paySign:t.sign,success:function(e){console.log("chooseWXPay:",e)}})}(window.wx,t.result.credential.wx)}},function(t){n.alert({title:"充值未成功",textContent:t.message,targetEvent:e})})}})}]});