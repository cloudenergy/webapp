"use strict";angular.module("app").service("$message",["$rootScope","$q","$ionicPopup","$state","$api",function(e,t,n,a,i){var o,r=this;angular.extend(r,{list:function(n){return e.User.data?i.message.list(angular.extend(n||{},{uid:e.User.data.uid,projectid:e.User.data.project})).$promise:t.reject()},readed:function(e){return i.message.readed(e||{},function(e){}).$promise},delete:function(e){return i.message.delete(e||{},function(e){}).$promise},check:function(){r.list({unread:1}).then(function(t){e.UNREADMESSAGE=t&&t.result&&t.result.detail||[];var i=localStorage.UNREADMESSAGE||"",r=i?i.split(","):[],c=[];angular.forEach(e.UNREADMESSAGE,function(e){!~r.indexOf(e.id)&&c.push(e.id)}),r=r.concat(c),localStorage.UNREADMESSAGE=r.join(),!o&&c.length&&(o=n.confirm({title:"通知提醒",template:"收到最新通知，是否立即查看？",cancelText:"稍后",okText:"查看"}).then(function(e){o=void 0,e&&a.go("app.notification")}))})}})}]);