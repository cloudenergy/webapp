"use strict";angular.module("app").service("$storage",["$cookies",function(e){var t=this,n="__emapp_",o={1:"APP_ANDROID",2:"APP_IOS",3:"WEB",4:"WECHAT"}[window.isWECHAT&&4||window.isAndroid&&1||window.isIOS&&2||3],i=window.isPRODUCTION?".cloudenergy.me":location.hostname,r={uid:"",token:"",client:o},s=e.getAll(),a=new window.Hashes.SHA1,c=function(e,t){var n=[],o=[];return angular.forEach(e,function(e,t){n.push(t)}),n.sort(),angular.forEach(n,function(t){o.push(t+"="+encodeURIComponent(angular.isObject(e[t])?JSON.stringify(e[t]):e[t]))}),t+o.toString().replace(/,/g,"")+t};angular.extend(t,{get:function(o){return o=t.expired()?void 0:e.get(o)||sessionStorage[n+o]||localStorage[n+o],"undefined"===o?void 0:o},set:function(s,a,c){s&&Object.keys(s).length?(s.client=o,!c&&Object.keys(r).map(function(t){e.put(t,s[t],{path:"/",domain:i,expires:a&&moment().add(10,"Y")._d||void 0})}),a?(t.expired(moment().add(10,"Y").unix()),Object.keys(r).map(function(e){localStorage[n+e]=s[e]})):(sessionStorage[n+"expires"]="Session",Object.keys(r).map(function(e){sessionStorage[n+e]=s[e]}))):(delete localStorage[n+"expires"],delete sessionStorage[n+"expires"],Object.keys(r).map(function(t){delete localStorage[n+t],delete sessionStorage[n+t],e.remove(t,{path:"/",domain:i})}))},expired:function(t){if(!t||!moment(t,"X"))return!e.get("token")&&(!sessionStorage[n+"expires"]&&(!(t=localStorage[n+"expires"])||moment(t,"X").isBefore(moment())));localStorage[n+"expires"]=t},valid:function(){var e=!0;return Object.keys(r).map(function(n){t.get(n)||(e=!1)}),e},encrypt:function(e){if(t.valid()){var n=moment().unix();e.client=o,e.v=n,e.t=t.get("token"),e.sign=a.hex(c(e,a.hex(n.toString()))),e.p=t.get("uid"),delete e.t}return e}}),Object.keys(s).length&&t.set(s,!1,!0)}]);