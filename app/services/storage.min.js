"use strict";angular.module("app").service("$storage",["$cookies",function(o){var a=this,i="__emapp_",r={1:"APP_ANDROID",2:"APP_IOS",3:"WEB",4:"WECHAT"}[(window.isWECHAT?4:window.isAndroid&&1)||window.isIOS&&2||3],s=window.isPRODUCTION?".cloudenergy.me":location.hostname,c={uid:"",token:"",client:r},e=o.getAll(),d=new window.Hashes.SHA1;angular.extend(a,{get:function(e){return"undefined"===(e=a.expired()?void 0:o.get(e)||sessionStorage[i+e]||localStorage[i+e])?void 0:e},set:function(t,n,e){t&&Object.keys(t).length?(t.client=r,!e&&Object.keys(c).map(function(e){o.put(e,t[e],{path:"/",domain:s,expires:n&&moment().add(10,"Y")._d||void 0})}),n?(a.expired(moment().add(10,"Y").unix()),Object.keys(c).map(function(e){localStorage[i+e]=t[e]})):(sessionStorage[i+"expires"]="Session",Object.keys(c).map(function(e){sessionStorage[i+e]=t[e]}))):(delete localStorage[i+"expires"],delete sessionStorage[i+"expires"],Object.keys(c).map(function(e){delete localStorage[i+e],delete sessionStorage[i+e],o.remove(e,{path:"/",domain:s})}))},expired:function(e){if(!e||!moment(e,"X"))return!o.get("token")&&(!sessionStorage[i+"expires"]&&(!(e=localStorage[i+"expires"])||moment(e,"X").isBefore(moment())));localStorage[i+"expires"]=e},valid:function(){var t=!0;return Object.keys(c).map(function(e){a.get(e)||(t=!1)}),t},encrypt:function(e){if(a.valid()){var t=moment().unix();e.client=r,e.v=t,e.t=a.get("token"),e.sign=d.hex((n=e,o=d.hex(t.toString()),i=[],s=[],angular.forEach(n,function(e,t){i.push(t)}),i.sort(),angular.forEach(i,function(e){s.push(e+"="+encodeURIComponent(angular.isObject(n[e])?JSON.stringify(n[e]):n[e]))}),o+s.toString().replace(/,/g,"")+o)),e.p=a.get("uid"),delete e.t}var n,o,i,s;return e}}),Object.keys(e).length&&a.set(e,!1,!0)}]);