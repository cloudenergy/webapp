"use strict";angular.module("app").service("$storage",function(){var e="__emapp_",t={uid:"",token:""},n=new Hashes.SHA1,o=function(e,t){var n=[],o=[];return angular.forEach(e,function(e,t){n.push(t)}),n.sort(),angular.forEach(n,function(t){o.push(t+"="+encodeURI(e[t]))}),t+o.toString().replace(/,/g,"")+t};angular.extend(this,{get:function(t){return this.expired()?void 0:sessionStorage[e+t]||localStorage[e+t]},set:function(n,o){n?o?(this.expired(moment().add(10,"Y").unix()),Object.keys(t).map(function(t){localStorage[e+t]=n[t]})):(sessionStorage[e+"expires"]="Session",Object.keys(t).map(function(t){sessionStorage[e+t]=n[t]})):(delete localStorage[e+"expires"],delete sessionStorage[e+"expires"],Object.keys(t).map(function(t){delete localStorage[e+t],delete sessionStorage[e+t]}))},expired:function(t){if(!t||!moment(t,"X"))return!sessionStorage[e+"expires"]&&(!(t=localStorage[e+"expires"])||moment(t,"X").isBefore(moment()));localStorage[e+"expires"]=t},valid:function(){var e=!0;return Object.keys(t).map(angular.bind(this,function(t){this.get(t)||(e=!1)})),e},encrypt:function(e){if(this.valid()){var t=moment().unix();e.v=t,e.t=this.get("token"),e.sign=n.hex(o(e,n.hex(t.toString()))),e.p=this.get("uid"),delete e.t}return e}})});