"use strict";angular.module("app").service("$storage",["$cookies",function(e){var t="__emapp_",n=window.isPRODUCTION?".cloudenergy.me":location.hostname,o={uid:"",token:""},i=e.getAll(),s=new window.Hashes.SHA1,a=function(e,t){var n=[],o=[];return angular.forEach(e,function(e,t){n.push(t)}),n.sort(),angular.forEach(n,function(t){o.push(t+"="+encodeURI(e[t]))}),t+o.toString().replace(/,/g,"")+t};angular.extend(this,{get:function(n){return this.expired()?void 0:e.get(n)||sessionStorage[t+n]||localStorage[t+n]},set:function(i,s,a){i?Object.keys(i).length&&(!a&&Object.keys(o).map(function(t){e.put(t,i[t],{path:"/",domain:n,expires:s&&moment().add(10,"Y")._d||void 0})}),s?(this.expired(moment().add(10,"Y").unix()),Object.keys(o).map(function(e){localStorage[t+e]=i[e]})):(sessionStorage[t+"expires"]="Session",Object.keys(o).map(function(e){sessionStorage[t+e]=i[e]}))):(delete localStorage[t+"expires"],delete sessionStorage[t+"expires"],Object.keys(o).map(function(o){delete localStorage[t+o],delete sessionStorage[t+o],e.remove(o,{path:"/",domain:n})}))},expired:function(n){if(!n||!moment(n,"X"))return!e.get("token")&&(!sessionStorage[t+"expires"]&&(!(n=localStorage[t+"expires"])||moment(n,"X").isBefore(moment())));localStorage[t+"expires"]=n},valid:function(){var e=!0;return Object.keys(o).map(angular.bind(this,function(t){this.get(t)||(e=!1)})),e},encrypt:function(e){if(this.valid()){var t=moment().unix();e.v=t,e.t=this.get("token"),e.sign=s.hex(a(e,s.hex(t.toString()))),e.p=this.get("uid"),delete e.t}return e}}),Object.keys(i).length&&this.set(i,!1,!0)}]);