"use strict";angular.module("app").factory("$exceptionHandler",["$storage",function(e){var t=[];return window.isWECHAT&&t.push("wechat"),!window.isPRODUCTION&&t.push(window.ionic.Platform.platform()),t.push(/preapi/.test(window.APIORIGIN)?"release":"production"),fundebug.apikey="5db959877819cb008bd51307bdf8c919c406d5ed5e81457db84503a3dd48251a",fundebug.releasestage=t.join("-"),window.AppVersion&&(fundebug.appversion=AppVersion.version),function(t){e.get("uid")&&(fundebug.user={uid:e.get("uid")}),fundebug.notifyError(t)}}]),function(e){function t(e,t,n){var r=e[t];e[t]=n(r)}function n(e){return"function"!=typeof e?e:(e.__injected__||(e.__injected__=function(){try{return e.apply(this,arguments)}catch(e){throw u(e),N=!0,e}}),e.__injected__)}function r(e){var t=/^[0-9a-z]{64}$/i;return!(!e||!e.match(t))}function a(e){return e?{name:e&&e.name,message:e&&e.message,fileName:e&&e.fileName||e&&e.sourceURL,lineNumber:e&&e.lineNumber||e&&e.line,columnNumber:e&&e.columnNumber||e&&e.column}:null}function i(){var e;try{throw new Error("")}catch(t){e=t.stack}if(e)return e=e.replace(/(.*?)fundebug(.*?)\.js(.*)\n?/gm,""),e=e.replace(/^Error\n/g,""),e="generated-stack:\n"+e}function o(){for(var e,t=[],n=arguments.callee.caller.caller;n&&t.length<10;){var r=n.toString().match(/function\s*([\w\_$]+)?\s*\(/i);e=r&&r[1]||"[anonymous]",t.push(e),n=n.caller}return"generated-stack:\n"+t.join("\n")}function u(e){if(e){var t=e.stack;t=t.replace(/(.*?)fundebug(.*?)\.js(.*)\n?/gm,"");var n=a(e);h({name:n.name||"uncaught error",message:n.message,fileName:n.fileName,lineNumber:n.lineNumber,columnNumber:n.columnNumber,stacktrace:t,severity:"error",type:"uncaught"})}}function s(e){var t=[];for(var n in e)if(e.hasOwnProperty(n)){var r='"'+n+'":',a=e[n];a&&("object"==typeof a?r+=s(a):"number"==typeof a?r+=a:r=r+'"'+a.replace(/\n/g,"\\n")+'"',t.push(r))}return"{"+t.join(",")+"}"}function c(t){var n,r=(n=t.target?t.target:t.srcElement)&&n.outerHTML;r&&r.length>200&&(r=r.slice(0,200));var a={type:"resourceError",target:{outerHTML:r,src:n&&n.src,tagName:n&&n.tagName,id:n&&n.id,className:n&&n.className,name:n&&n.name,type:n&&n.type,XPath:l(n),selector:m(n)}};if(n.src!==e.location.href&&(!n.src||!n.src.match(/.*\/(.*)$/)||n.src.match(/.*\/(.*)$/)[1])&&a.target.src&&e.XMLHttpRequest){var i=new XMLHttpRequest;i.Fundebug=!0,i.open("HEAD",a.target.src),i.send(),i.onload=function(e){200!==e.target.status&&(a.target.status=e.target.status,a.target.statusText=e.target.statusText),h(a)}}}function l(e){for(var t=[];e&&e.nodeType==Node.ELEMENT_NODE;e=e.parentNode){var n,r=0,a=!1;for(n=e.previousSibling;n;n=n.previousSibling)n.nodeType!=Node.DOCUMENT_TYPE_NODE&&n.nodeName==e.nodeName&&++r;for(n=e.nextSibling;n&&!a;n=n.nextSibling)n.nodeName==e.nodeName&&(a=!0);var i=(e.prefix?e.prefix+":":"")+e.localName,o=r||a?"["+(r+1)+"]":"";t.splice(0,0,i+o)}return t.length?"/"+t.join("/"):null}function m(e){for(var t=[];e.parentNode;){if(e.id){t.unshift("#"+e.id);break}if(e==e.ownerDocument.documentElement)t.unshift(e.tagName);else{for(var n=1,r=e;r.previousElementSibling;r=r.previousElementSibling,n++);t.unshift(e.tagName+":nth-child("+n+")")}e=e.parentNode}return t.join(" > ")}function d(e){w.push(e),w.length>20&&w.shift()}function f(t){var n,r=(n=t.target?t.target:t.srcElement)&&n.outerHTML;r&&r.length>200&&(r=r.slice(0,200)),d({type:"click",page:{url:e.location.href,title:document.title},detail:{outerHTML:r,tagName:n&&n.tagName,id:n&&n.id,className:n&&n.className,name:n&&n.name},time:(new Date).getTime()})}function p(e,t){L=t,d({type:"navigation",detail:{from:e,to:t},time:(new Date).getTime()})}function g(e){return!(b.silentHttp||0===e.detail.status&&/^(data:text\/html|file:\/\/\/)/.test(e.detail.url)||2===parseInt(e.detail.status/100))}function h(t){if(r(E.getAttribute("apikey")||b.apikey)&&b.maxEventNumber&&!b.silent){b.maxEventNumber-=1;var n={notifierVersion:"0.1.9",userAgent:e.navigator.userAgent,locale:e.navigator.language||e.navigator.userLanguage,url:e.location.href,title:document.title,appVersion:E.getAttribute("appversion")||b.appversion,apiKey:E.getAttribute("apikey")||b.apikey,releaseStage:E.getAttribute("releasestage")||b.releasestage,metaData:t.metaData||b.metaData,user:t.user||b.user,name:t.name,time:(new Date).getTime(),message:t.message,fileName:t.fileName,lineNumber:t.lineNumber,columnNumber:t.columnNumber,stacktrace:t.stacktrace,type:t.type,severity:t.severity,target:t.target,req:t.req,res:t.res,breadcrumbs:w};n.userAgent&&n.userAgent.match(/Googlebot/)||v(n)}}function v(t){var n;if(n="undefined"==typeof JSON?s(t):JSON.stringify(t),e.XMLHttpRequest&&e.atob){var r=new XMLHttpRequest;r.Fundebug=!0,r.open("POST","https://fundebug.com/javascript/"),r.setRequestHeader("Content-Type","application/json"),r.send(n)}else(new Image).src=y+"?event="+encodeURIComponent(n)}var y="https://fundebug.com/javascript/",b={};e.fundebug=b;var N=!1,E=function(){var e=document.currentScript;if(!e){var t=document.scripts;e=t[t.length-1]}return e}();b.silent=E.getAttribute("silent")||!1,b.maxEventNumber=E.getAttribute("maxEventNumber")||10,b.silentResource=E.getAttribute("silentResource")||!1,b.silentHttp=E.getAttribute("silentHttp")||!1,t(e,"onerror",function(){return function(t,n,r,i,u){if(N)N=!1;else{void 0===i&&e.event&&(i=e.event.errorCharacter);var s;s=n&&n!==e.location.href?n:null;var c=a(u);h({message:t,lineNumber:r,columnNumber:i,fileName:s||c&&c.fileName,name:c&&c.name||"uncaught error",stacktrace:u&&u.stack||o(),severity:"error",type:"uncaught"})}}});var T=!0;if(e.atob){if(e.ErrorEvent)try{e.ErrorEvent.prototype.hasOwnProperty("error")&&(T=!1)}catch(e){}}else T=!1;"EventTarget Window Node ApplicationCache AudioTrackList ChannelMergerNode CryptoOperation EventSource FileReader HTMLUnknownElement IDBDatabase IDBRequest IDBTransaction KeyOperation MediaController MessagePort ModalWindow Notification SVGElementInstance Screen TextTrack TextTrackCue TextTrackList WebSocket WebSocketWorker Worker XMLHttpRequest XMLHttpRequestEventTarget XMLHttpRequestUpload".replace(/\w+/g,function(r){if(T){var a=e[r]&&e[r].prototype;a&&a.hasOwnProperty&&a.hasOwnProperty("addEventListener")&&(t(a,"addEventListener",function(e){return function(t,r,a,i){return r&&r.handleEvent&&(r.handleEvent=n(r.handleEvent)),e.call(this,t,n(r),a,i)}}),t(a,"removeEventListener",function(e){return function(t,r,a){return e.call(this,t,r,a),e.call(this,t,n(r),a)}}))}}),b.notify=function(e,t,n){if(e)return h({name:e||n&&n.name,message:t||n&&n.message,severity:n&&n.message||"warning",stacktrace:i(),type:"notification",user:n&&n.user,metaData:n&&n.metaData}),"fundebug.com"===location.host?"äº²ï¼Œä¸è¦åœ¨Fundebugç½‘ç«™æµ‹è¯•å“¦ï¼›è¯·å°†Fundebugæ’ä»¶é›†æˆåˆ°æ‚¨çš„ç½‘ç«™ï¼Œç„¶åŽè¿›è¡Œæµ‹è¯•!":"è¯·æŸ¥çœ‹é‚®ç®±ä»¥åŠFundebugæŽ§åˆ¶å°!"},b.notifyError=function(e,t){if(e){var n=a(e);h({name:n.name||t&&t.name||"caught error",message:n.message||t&&t.message,stacktrace:e.stack,fileName:n.fileName,lineNumber:n.lineNumber,columnNumber:n.columnNumber,severity:t&&t.severity||"error",type:"caught",user:t&&t.user,metaData:t&&t.metaData})}},b.notifyHttpError=function(e,t,n){h({type:"httpError",req:e,res:t,user:n&&n.user,metaData:n&&n.metaData})},e.addEventListener&&e.addEventListener("unhandledrejection",function(e){b.notifyError(e.reason)}),e.addEventListener&&e.addEventListener("error",c,!0);var w=[];e.addEventListener?e.addEventListener("click",f,!0):document.attachEvent("onclick",f);var L={url:e.location.href};document.addEventListener?document.addEventListener("DOMContentLoaded",function(){L={url:e.location.href,title:document.title}}):document.attachEvent("onreadystatechange",function(){L={url:e.location.href,title:document.title}});var k=e.onpopstate;e.onpopstate=function(){var t={url:e.location.href};if(L.title||(L.title=document.title),L.url!==t.url&&p(L,t),k)return k.apply(this,arguments)};var x=e.history.pushState;e.history.pushState=function(){L={url:e.location.href,title:document.title};var t={};if(3===arguments.length&&(t.url=arguments[2]),L.url!==t.url&&p(L,t),x)return x.apply(this,arguments)};var D=e.onhashchange;if(e.onhashchange=function(){var t={url:e.location.href,title:document.title};if(L.url!==t.url&&p(L,t),D)return D.apply(this,arguments)},e.XMLHttpRequest){var H=XMLHttpRequest.prototype;if(!H)return;var M,R,S=H.open,A=H.send;H.open=function(e,t){return M=e,R=t,S.apply(this,arguments)},H.send=function(){var t=this,n=t.onreadystatechange;return t.onreadystatechange=function(){if(4===t.readyState&&!t.Fundebug&&R!=y){var r={type:"XMLHttpRequest",page:{url:e.location.href},detail:{method:M,url:t.responseURL||R,status:t.status,statusText:t.statusText},time:(new Date).getTime()};if(g(r)){var a={method:r.detail.method,url:r.detail.url},i={status:t.status,statusText:t.statusText,response:t.response};b.notifyHttpError(a,i)}d(r)}n&&n.apply(this,arguments)},A.apply(this,arguments)}}if(e.fetch){var O=e.fetch;e.fetch=function(t,n){return O.apply(this,arguments).then(function(t){var r={type:"fetch",page:{url:e.location.href,title:document.title},detail:{method:n&&n.method||"GET",url:t.url,status:t.status,statusText:t.statusText},time:(new Date).getTime()};if(g(r)){var a={method:r.detail.method,url:r.detail.url},i={status:t.status,statusText:t.statusText};b.notifyHttpError(a,i)}return d(r),t})}}var _="function"==typeof define,j="undefined"!=typeof module&&module.exports;_?define(b):j&&(module.exports=b)}(window);