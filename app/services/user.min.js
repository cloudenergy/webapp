"use strict";angular.module("app").service("User",["$rootScope","$q","$cookies","$api",function(e,o,t,r){var n=this,a={},i=/cloudenergy\.me/.test(location.hostname)?".cloudenergy.me":location.hostname;e.User=n,angular.extend(n,{client:void 0,data:void 0,$userinfo:function(e){var i=o.defer();return r.business.userinfo(e||{},function(e){n.client=t.get("client")||"WEB",a=angular.extend(a,e.result),i.resolve(n.data=a)},i.reject),i.promise},$login:function(e){e=e||{};var u=o.defer(),s=e.remember;return delete e.remember,r.auth.login(e,function(e){a=e.result,angular.forEach(["token","uid","user"],function(e){a[e]&&t.put(e,a[e]||!1,{path:"/",domain:i,expires:s&&moment().add(1,"months")._d||void 0})}),n.$userinfo().then(u.resolve,u.reject)},u.reject),u.promise},$logout:function(e){var a=o.defer();return r.auth.logout(e||{},function(){delete n.data,angular.forEach(["token","uid","user"],function(e){t.remove(e,{path:"/",domain:".www"+i}),t.remove(e,{path:"/",domain:i}),t.remove(e,{path:"/"})}),a.resolve()},a.reject),a.promise}})}]);