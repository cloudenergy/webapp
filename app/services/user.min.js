"use strict";angular.module("app").service("User",["$rootScope","$q","$cookies","$api","$localStorage","$sessionStorage","ngStoragePrefixUpdate",function(e,t,r,o,n,a,c){var d=this,i=/cloudenergy\.me/.test(location.hostname)?".cloudenergy.me":location.hostname;angular.extend(d,{data:void 0,project:function(){var r=t.defer();return o.project.info(function(t){e.Project=angular.isArray(t.result)?t.result:[t.result],e.Project.length?(n.project_selected&&angular.forEach(e.Project,function(t){t._id===n.project_selected&&(e.Project.selected=t)}),!e.Project.selected&&angular.forEach(e.Project,function(t){t._id===d.data.project&&(e.Project.selected=t)}),e.Project.selected=e.Project.selected||e.Project[0],n.project_selected=e.Project.selected._id,r.resolve(e.Project)):r.reject()},r.reject),r.promise},userinfo:function(n){var i=t.defer();return o.business.userinfo(n||{},function(t){d.data=angular.extend(d.data||{},t.result||{}),c("cloudenergy-"+d.data.uid+"-"),a.client=r.get("client")||"WEB","WEB"===a.client?d.project().then(function(){e.UserInfo=d.data,i.resolve(d.data)},function(t){delete e.UserInfo,i.reject(t)}):(e.UserInfo=d.data,i.resolve(d.data))},i.reject),i.promise},login:function(e){var n=t.defer();return o.auth.login(e||{},function(e){d.data=e.result,angular.forEach(["token","uid","user"],function(e){d.data[e]&&r.put(e,d.data[e]||!1,{path:"/",domain:i,expires:d.remember&&moment().add(1,"months")._d||void 0})}),d.userinfo().then(n.resolve,n.reject)},n.reject),n.promise},logout:function(n){var a=t.defer();return o.auth.logout(n||{},function(){delete e.UserInfo,delete e.Project,delete d.data,angular.forEach(["token","uid","user"],function(e){r.remove(e,{path:"/",domain:".www"+i}),r.remove(e,{path:"/",domain:i}),r.remove(e,{path:"/"})}),a.resolve()},a.reject),a.promise}})}]);