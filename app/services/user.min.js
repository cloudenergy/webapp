"use strict";angular.module("app").service("Account",["$rootScope","$q","$api",function(e,t,o){var n=this;angular.extend(n,{data:void 0,info:function(r){var a=t.defer();return o.account.info(r||{},function(t){!t.code&&t.result?(e.Account=n.data=t.result,a.resolve(t)):a.reject(t)},function(e){a.reject(e)}),a.promise}})}]).service("User",["$rootScope","$q","$cookies","$api","Account",function(e,t,o,n,r){var a=this,u=/cloudenergy\.me/.test(location.hostname)?".cloudenergy.me":location.hostname;angular.extend(a,{data:void 0,userinfo:function(o){var r=t.defer();return n.business.userinfo(o||{uid:a.data.uid},function(t){!t.code&&t.result?(a.data=angular.extend(e.UserInfo||a.data,t.result),r.resolve(a.data)):r.reject(t)},function(e){r.reject(e)}),r.promise},login:function(r){var i=t.defer();return n.auth.login(r||{},function(n){!n.code&&n.result&&n.result.token?(a.data=n.result,angular.forEach(["token","uid","user"],function(e){a.data[e]&&o.put(e,a.data[e]||!1,{path:"/",domain:u,expires:a.remember&&moment().add(1,"months")._d||void 0})}),t.all([a.userinfo()]).then(function(){i.resolve(e.UserInfo=a.data)},function(){i.reject(n)})):i.reject(n)},function(e){i.reject(e)}),i.promise},logout:function(r){var i=t.defer();return n.auth.logout(r||{},function(){delete e.UserInfo,delete a.data,i.resolve()},function(e){angular.forEach(["token","uid","user"],function(e){o.remove(e,{path:"/",domain:".www"+u}),o.remove(e,{path:"/",domain:u}),o.remove(e,{path:"/"})}),i.reject(e)}),i.promise}})}]);