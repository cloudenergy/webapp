"use strict";angular.module("app").service("User",["$rootScope","$q","$api","$fundebug","$jpush","$message","$storage",function(r,s,n,u,o,l,a){angular.extend(r.User=this,{data:void 0,$userinfo:function(e){var t=s.defer();return n.business.userinfo(e||{},function(e){/^USER$/.test(e.result.character._id)?(r.User.data=angular.extend({},e.result),delete e.result.character.rule,u.metaData({userinfo:e.result}),t.resolve(e)):(a.set(null),t.reject({code:90000009}))},function(e){a.set(null),t.reject(e)}),t.promise},$login:function(e){var t=s.defer();return n.auth.login(e||{},function(e){a.set(e.result,!0),r.User.$userinfo().then(function(e){!window.isPRODUCTION&&o.setAlias(localStorage.JPUSH_ALIAS=e.result.userid),l.check(),t.resolve(e)},function(e){a.set(null),t.reject(e)})},t.reject),t.promise},$logout:function(e){return n.auth.logout(e||{},function(){delete r.User.data,delete localStorage.JPUSH_ALIAS,a.set(null),!window.isPRODUCTION&&o.setAlias("")}).$promise}})}]);