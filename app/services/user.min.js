"use strict";angular.module("app").service("User",["$rootScope","$q","$api","$fundebug","$jpush","$message","$storage",function(e,t,r,s,u,n,i){angular.extend(e.User=this,{data:void 0,$userinfo:function(u){var n=t.defer();return r.business.userinfo(u||{},function(t){/^USER$/.test(t.result.character._id)?(e.User.data=angular.extend({},t.result),delete t.result.character.rule,s.metaData({userinfo:t.result}),n.resolve(t)):(i.set(null),n.reject({code:90000009}))},function(e){i.set(null),n.reject(e)}),n.promise},$login:function(s){var o=t.defer(),a={token:"",uid:"",userid:""};return r.auth.login(s||{},function(t){Object.keys(a).map(function(e){a[e]=t.result[e]||""}),i.set(a,!0),e.User.$userinfo().then(function(e){a.userid=e.result.userid,i.set(a,!0),n.check(),!window.isPRODUCTION&&u.setAlias(e.result.userid),o.resolve(e)},function(e){i.set(null),o.reject(e)})},o.reject),o.promise},$logout:function(t){return r.auth.logout(t||{},function(){delete e.User.data,i.set(null),!window.isPRODUCTION&&u.setAlias("")}).$promise}})}]);