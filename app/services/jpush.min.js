"use strict";angular.module("app").run(["$rootScope","$state","$ionicPlatform","$ionicPopup","$api","$jpush","User",function(n,i,t,e,o,u,a){var c,r,s=!0,d=function(){c=setTimeout(function(){f().then(l)},1666.66)},l=function(){c&&(clearTimeout(c),c=void 0),f().then(function(){r||(r=e.confirm({title:"通知提醒",template:"收到最新通知，是否立即查看？",cancelText:"稍后",okText:"查看"}).then(function(n){r=void 0,n&&n&&i.go("app.notification")}))})},f=function(){return o.message.list({uid:a.data.uid,projectid:a.data.project,unread:1},function(i){n.UNREADMESSAGE=i.result}).$promise};window.isPRODUCTION||(t.on("resume",function(){s=!0,u.clearAndroid(),u.clearIOS(),d()}),t.on("pause",function(){s=!1}),document.addEventListener("jpush.openNotification",function(){l(),u.clearAndroid(),u.clearIOS()},!1),document.addEventListener("jpush.receiveNotification",function(){l(),s&&(u.clearAndroid(),u.clearIOS())},!1))}]).service("$jpush",["$storage",function(n){if(!window.isPRODUCTION){var i,t=this;angular.extend(t,{clearAndroid:function(){setTimeout(function(){i.clearAllNotification()},1666.66)},clearIOS:function(){setTimeout(function(){i.resetBadge(),i.setApplicationIconBadgeNumber(0)},1666.66)},setAlias:function(n,t,e){i.setAlias(angular.isNumber(n)?n.toString():n,t||angular.noop,e||angular.noop)}}),(i=window.plugins&&window.plugins.jPushPlugin).init(),t.clearAndroid(),t.clearIOS(),!n.expired()&&i.getRegistrationID(function(i){i?t.setAlias(n.get("uid")):setTimeout(function(){t.setAlias(n.get("uid"))},5e3)})}}]);