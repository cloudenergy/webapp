"use strict";angular.module("app").constant("APICONFIG",{auth:["auth",,{login:{},logout:{}}],account:["account",,{passwd:{},unbind:{url:"wxaccount/unbind"},wxbind:{url:"wxaccount/bind"}}],apptemplate:["apptemplate",,{info:{}}],business:["business",,{userinfo:{},recentchargelog:{},fundflow:{},monitor:{},timequantumstatistic:{}}],device:["device",,{type:{}}],payment:["payment",,{channelinfo:{},charge:{}}],control:["control",,{send:{}}],department:["department",,{update:{}}],interaction:["interaction",,{uploadtoken:{}}],workorder:["workorder",,{add:{},info:{}}],qiniu:["qiniu",,{put:{url:window.APIORIGIN+"/putb64/-1/key/:base64",transformRequest:function(e){return e.file},headers:{"Content-Type":"application/octet-stream",Authorization:function(e){if(e.params&&e.params.token){var n=e.params.token;return delete e.params.token,"UpToken "+n}}}}}]}).config(["$qProvider","$httpProvider",function(e,n){e.errorOnUnhandledRejections(!1),n.interceptors.push(["$rootScope","$q","$location","$timeout","$storage",function(e,n,r,t,a){function o(n,r){r?(angular.isObject(n.params)&&(n._inprogress=n.params._inprogress,delete n.params._inprogress),angular.isObject(n.data)&&angular.isUndefined(n._inprogress)&&(n._inprogress=n.data._inprogress,delete n.data._inprogress),!1!==n._inprogress&&(n._inprogress=t(function(){e.HttpInProgress++,n._inprogress=e.HttpInProgress},60))):(!1!==n._inprogress&&(angular.isNumber(n._inprogress)?t(function(){e.HttpInProgress--},60):angular.isObject(n._inprogress)&&t.cancel(n._inprogress)),delete n._inprogress)}return e.HttpInProgress=0,{request:function(e){return o(e,!0),window.isPRODUCTION||!/\/api\//.test(e.url)||/\/api\/auth\/(login|logout)/.test(e.url)||(e.transformRequest=e.transformRequest.concat([function(e){return JSON.stringify(a.encrypt(JSON.parse(e||"{}")))}])),e},requestError:function(e){return n.reject(e)},response:function(e){return e.config&&o(e.config,!1),angular.isObject(e.data)&&(e.data.code||angular.isObject(e.data.result)&&!Object.keys(e.data.result).length)?(/90000005|90000007/.test(e.data.code)&&r.url("/m/login").replace(),n.reject(e.data)):e},responseError:function(e){return e.config&&o(e.config,!1),n.reject(e.data||{code:e.status})}}}])}]).service("$api",["$rootScope","$resource","APICONFIG",function(e,n,r){var t=function(e,n){return/(^http:\/\/)|(^https:\/\/)/.test(e)&&e||[window.APIORIGIN+"/api/"+e,n&&"/:_api_action"||""].join("")},a=[];e.$on("$stateChangeStart",function(){angular.forEach(a,function(e){!e.$resolved&&e.$cancelRequest()}),a=[]}),angular.forEach(r,function(e,r){angular.isArray(e)&&e[0]&&(e[0]=t(e[0],!!e[2]),e[3]=angular.extend({cancellable:!0},e[3]),angular.forEach(e[2],function(n,r){n.url=n.url&&t(n.url)||void 0,n.method=n.method||"POST",n.params=n.params||{},n.params._api_action=n.url?void 0:r,window.isPRODUCTION||(n.headers=n.headers||{},n.headers["X-Cors-By"]="cloudenergy.me"),/api\.cloudenergy\.me/.test(n.url||e[0])&&(n.withCredentials=!0)}),angular.forEach(this[r]=n.apply(n,e),function(e,n){this[n]=function(){var n,r;return angular.forEach([arguments[0],arguments[1]],function(e){angular.isObject(e)&&angular.isDefined(e._cancellable)&&(r=e._cancellable,delete e._cancellable)}),n=e.apply(this,arguments),!1===r&&delete n.$cancelRequest,n.$cancelRequest&&a.push(n),n}},this[r]))},this)}]);