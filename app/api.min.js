"use strict";angular.module("app").constant("APICONFIG",{auth:["auth",,{login:{},logout:{}}],account:["account",,{info:{},passwd:{},unbind:{url:"wxaccount/unbind"},wxbind:{url:"wxaccount/bind"}}],apptemplate:["apptemplate",,{info:{}}],business:["business",,{userinfo:{},recentchargelog:{},fundflow:{}}],device:["device",,{type:{}}],sensor:["sensor",,{info:{}}],payment:["payment",,{channelinfo:{},charge:{}}],project:["project",,{info:{}}],control:["control",,{send:{}}],department:["department",,{update:{}}],interaction:["interaction",,{uploadtoken:{}}],workorder:["workorder",,{add:{},info:{}}],qiniu:["qiniu",,{put:{url:location.origin+"/putb64/-1/key/:base64",transformRequest:function(t){return t.file},headers:{"Content-Type":"application/octet-stream",Authorization:function(t){if(t.params&&t.params.token){var e=t.params.token;return delete t.params.token,"UpToken "+e}}}}}]}).config(["$httpProvider",function(t){t.interceptors.push(["$rootScope","$q","$location","$timeout",function(t,e,a,r){return t.HttpRequestInProgress=0,{request:function(e){return t.HttpRequestInProgress++,e},requestError:function(t){return e.reject(t)},response:function(n){return r(function(){t.HttpRequestInProgress--},100),angular.isObject(n.data)&&(n.data.code||n.data.err||!n.data.result||angular.isArray(n.data.result)&&!n.data.result.length||angular.isObject(n.data.result)&&!Object.keys(n.data.result).length)?(/90000005|90000007/.test(n.data.code)&&a.url("/m/logout").replace(),e.reject(n.data)):n},responseError:function(a){return r(function(){t.HttpRequestInProgress--},100),e.reject(angular.isObject(a.data)?a.data:a)}}}])}]).service("$api",["$rootScope","$resource","$location","$state","APICONFIG",function(t,e,a,r,n){var u=function(t,e){return/(^http:\/\/)|(^https:\/\/)/.test(t)&&t||[localStorage.testapi&&"/testapi/"||"/api/",t,e&&"/:_api_action"||""].join("")},o=function(t){return angular.isArray(this)&&{parameters:!angular.isFunction(arguments[0])&&arguments[0]||void 0,postData:!angular.isFunction(arguments[1])&&arguments[1]||void 0}||{parameters:!angular.isFunction(t.parameters)&&t.parameters||void 0,postData:!angular.isFunction(t.postData)&&t.postData||void 0}},i=function(t){angular.forEach(r._api_request[t],function(t){t.request.$cancelRequest()}),delete r._api_request[t]};r._api_request={},t.$on("$stateChangeStart",function(t,e,a,r){e.name!==r.name&&i(r._api_url)}),t.$on("$stateChangeSuccess",function(t,e,r,n){a.url()!==n._api_url&&i(n._api_url)}),angular.forEach(n,function(t,n){angular.isArray(t)&&t[0]&&(t[0]=u(t[0],!!t[2]),t[3]=angular.extend({cancellable:!0},t[3]),angular.forEach(t[2],function(t,e){angular.extend(t,{url:t.url&&u(t.url)||void 0,method:t.method||"POST",params:angular.extend(t.url&&{}||{_api_action:e},t.params)})}),angular.forEach(this[n]=e.apply(e,t),function(t,e,u,i){this[e]=function(){return i=angular.isObject(arguments[0])&&arguments[0].cancellable,i&&delete arguments[0].cancellable,u=t.apply(this,arguments),u.$cancelRequest&&!u[0]&&(r.current._api_url=a.url(),r._api_request[r.current._api_url]=r._api_request[r.current._api_url]||{},function(t,a){t&&(i||angular.equals(a,o.call({},t))?t.request.$resolved||(t.request.$cancelRequest(),!i&&console.warn("duplicate request:",localStorage.testapi&&"testapi"||"api","/",n,"/",e)):r._api_request[r.current._api_url][n+"_"+e+"_"+Date.now()]=t)}(r._api_request[r.current._api_url][n+"_"+e+"_recently"],o.apply([],arguments)),r._api_request[r.current._api_url][n+"_"+e+"_recently"]=angular.extend({request:u},o.apply([],arguments))),u}},this[n]))},this)}]);