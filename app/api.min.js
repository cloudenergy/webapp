"use strict";angular.module("app").constant("APICONFIG",{auth:["auth",,{login:{},logout:{}}],account:["account",,{info:{},passwd:{},unbind:{url:"wxaccount/unbind"},wxbind:{url:"wxaccount/bind"}}],apptemplate:["apptemplate",,{info:{}}],business:["business",,{userinfo:{},recentchargelog:{},fundflow:{}}],device:["device",,{type:{}}],sensor:["sensor",,{info:{}}],payment:["payment",,{channelinfo:{},charge:{}}],project:["project",,{info:{}}],control:["control",,{send:{}}],department:["department",,{update:{}}],interaction:["interaction",,{uploadtoken:{}}],workorder:["workorder",,{add:{},info:{}}],qiniu:["qiniu",,{put:{url:location.origin+"/putb64/-1/key/:base64",transformRequest:function(t){return t.file},headers:{"Content-Type":"application/octet-stream",Authorization:function(t){if(t.params&&t.params.token){var e=t.params.token;return delete t.params.token,"UpToken "+e}}}}}]}).config(["$httpProvider",function(t){t.interceptors.push(["$rootScope","$q","$location","$timeout",function(t,e,a,n){return t.HttpRequestInProgress=0,{request:function(e){return t.HttpRequestInProgress++,e},requestError:function(t){return e.reject(t)},response:function(r){return n(function(){t.HttpRequestInProgress--},100),angular.isObject(r.data)&&(r.data.code||!r.data.result||angular.isObject(r.data.result)&&!Object.keys(r.data.result).length)?(/90000005|90000007/.test(r.data.code)&&a.url("/m/logout").replace(),e.reject(r.data)):r},responseError:function(a){return n(function(){t.HttpRequestInProgress--},100),e.reject(angular.isObject(a.data)?a.data:a)}}}])}]).service("$api",["$rootScope","$resource","$location","$state","APICONFIG",function(t,e,a,n,r){var u=function(t,e){return/(^http:\/\/)|(^https:\/\/)/.test(t)&&t||[localStorage.testapi&&"/testapi/"||"/api/",t,e&&"/:_api_action"||""].join("")},o=function(t){return angular.isArray(this)&&{parameters:!angular.isFunction(arguments[0])&&arguments[0]||void 0,postData:!angular.isFunction(arguments[1])&&arguments[1]||void 0}||{parameters:!angular.isFunction(t.parameters)&&t.parameters||void 0,postData:!angular.isFunction(t.postData)&&t.postData||void 0}},i=function(t){angular.forEach(n._api_request[t],function(t){t.request.$cancelRequest()}),delete n._api_request[t]};n._api_request={},t.$on("$stateChangeStart",function(t,e,a,n){e.name!==n.name&&i(n._api_url)}),t.$on("$stateChangeSuccess",function(t,e,n,r){a.url()!==r._api_url&&i(r._api_url)}),angular.forEach(r,function(t,r){angular.isArray(t)&&t[0]&&(t[0]=u(t[0],!!t[2]),t[3]=angular.extend({cancellable:!0},t[3]),angular.forEach(t[2],function(t,e){angular.extend(t,{url:t.url&&u(t.url)||void 0,method:t.method||"POST",params:angular.extend(t.url&&{}||{_api_action:e},t.params)})}),angular.forEach(this[r]=e.apply(e,t),function(t,e,u,i){this[e]=function(){return i=angular.isObject(arguments[0])&&arguments[0].cancellable,i&&delete arguments[0].cancellable,u=t.apply(this,arguments),u.$cancelRequest&&!u[0]&&(n.current._api_url=a.url(),n._api_request[n.current._api_url]=n._api_request[n.current._api_url]||{},function(t,a){t&&(i||angular.equals(a,o.call({},t))?t.request.$resolved||(t.request.$cancelRequest(),!i&&console.warn("duplicate request:",localStorage.testapi&&"testapi"||"api","/",r,"/",e)):n._api_request[n.current._api_url][r+"_"+e+"_"+Date.now()]=t)}(n._api_request[n.current._api_url][r+"_"+e+"_recently"],o.apply([],arguments)),n._api_request[n.current._api_url][r+"_"+e+"_recently"]=angular.extend({request:u},o.apply([],arguments))),u}},this[r]))},this)}]);