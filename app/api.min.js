"use strict";angular.module("app").constant("APICONFIG",{auth:["auth",,{login:{},logout:{}}],account:["account",,{passwd:{},unbind:{url:"wxaccount/unbind"},wxbind:{url:"wxaccount/bind"}}],apptemplate:["apptemplate",,{info:{},update:{},delete:{}}],business:["business",,{userinfo:{},recentchargelog:{},fundflow:{}}],device:["device",,{type:{}}],sensor:["sensor",,{info:{}}],payment:["payment",,{channelinfo:{},charge:{}}],control:["control",,{send:{}}],department:["department",,{update:{}}],interaction:["interaction",,{uploadtoken:{}}],workorder:["workorder",,{add:{},info:{}}],qiniu:["qiniu",,{put:{url:location.origin+"/putb64/-1/key/:base64",transformRequest:function(e){return e.file},headers:{"Content-Type":"application/octet-stream",Authorization:function(e){if(e.params&&e.params.token){var n=e.params.token;return delete e.params.token,"UpToken "+n}}}}}]}).config(["$httpProvider",function(e){e.interceptors.push(["$rootScope","$q","$location","$timeout",function(e,n,t,a){return e.HttpInProgress=0,{request:function(n){return angular.isObject(n.params)&&(n._inprogress=n.params._inprogress,delete n.params._inprogress),angular.isUndefined(n._inprogress)&&angular.isObject(n.data)&&(n._inprogress=n.data._inprogress,delete n.data._inprogress),n._inprogress!==!1&&e.HttpInProgress++,n},requestError:function(e){return n.reject(e)},response:function(r){return r.config._inprogress!==!1&&a(function(){e.HttpInProgress--},60),delete r.config._inprogress,angular.isObject(r.data)&&(r.data.code||angular.isObject(r.data.result)&&!Object.keys(r.data.result).length)?(/90000005|90000007/.test(r.data.code)&&t.url("/m/logout").replace(),n.reject(r.data)):r},responseError:function(t){return t.config._inprogress!==!1&&a(function(){e.HttpInProgress--},60),delete t.config._inprogress,n.reject(t.data||{code:t.status})}}}])}]).service("$api",["$rootScope","$resource","APICONFIG",function(e,n,t){var a=function(e,n){return/(^http:\/\/)|(^https:\/\/)/.test(e)&&e||[localStorage.testapi&&"/testapi/"||"/api/",e,n&&"/:_api_action"||""].join("")},r=[];e.$on("$stateChangeStart",function(){angular.forEach(r,function(e){!e.$resolved&&e.$cancelRequest()}),r=[]}),angular.forEach(t,function(e,t){angular.isArray(e)&&e[0]&&(e[0]=a(e[0],!!e[2]),e[3]=angular.extend({cancellable:!0},e[3]),angular.forEach(e[2],function(e,n){angular.extend(e,{url:e.url&&a(e.url)||void 0,method:e.method||"POST",params:angular.extend(e.url&&{}||{_api_action:n},e.params)})}),angular.forEach(this[t]=n.apply(n,e),function(e,n){this[n]=function(){var n,t;return angular.isObject(arguments[0])&&angular.isDefined(arguments[0]._cancellable)&&(t=arguments[0]._cancellable,delete arguments[0]._cancellable),angular.isObject(arguments[1])&&angular.isDefined(arguments[1]._cancellable)&&(t=arguments[1]._cancellable,delete arguments[1]._cancellable),n=e.apply(this,arguments),t===!1&&delete n.$cancelRequest,n.$cancelRequest&&r.push(n),n}},this[t]))},this)}]);