"use strict";angular.module("app",["ionic","ngCookies","ngResource","oc.lazyLoad"]).config(["$locationProvider","$ionicConfigProvider",function(o,n){n.tabs.position("bottom"),window.isPRODUCTION?o.html5Mode(!0):o.hashPrefix("")}]).run(["$location","$ionicPlatform","$ionicHistory","$ionicPopup",function(i,o,t,e){o.ready(function(){window.cordova&&window.cordova.plugins&&window.cordova.plugins.Keyboard&&(window.cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),window.cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar&&window.StatusBar.styleBlackTranslucent()}),o.registerBackButtonAction(function(o){o.preventDefault();var n=function(){e.confirm({title:"<strong>退出应用?</strong>",template:"你确定要退出应用吗?",okText:"退出",cancelText:"取消"}).then(function(o){o&&window.ionic.Platform.exitApp()})};return/m\/(index|welcome|error|login|bind)/.test(i.path())?n():t.backView()?t.goBack():n(),!1},101)}]),window.isPRODUCTION?angular.element(document).ready(function(){angular.bootstrap(document,["app"])}):document.addEventListener("deviceready",function(){angular.bootstrap(document,["app"])},!1);
"use strict";angular.module("app").constant("APICONFIG",{auth:["auth",,{login:{},logout:{}}],account:["account",,{passwd:{},unbind:{url:"wxaccount/unbind"},wxbind:{url:"wxaccount/bind"}}],apptemplate:["apptemplate",,{info:{}}],business:["business",,{userinfo:{},recentchargelog:{},fundflow:{},monitor:{},timequantumstatistic:{}}],device:["device",,{type:{}}],payment:["payment",,{channelinfo:{},charge:{}}],control:["control",,{send:{}}],department:["department",,{update:{}}],message:["message",,{list:{},readed:{},delete:{}}],workorder:["workorder",,{add:{},info:{}}],interaction:["interaction",,{uploadtoken:{}}],qiniu:["qiniu",,{upload:{url:window.APIORIGIN+"/putb64/-1/key/:base64",transformRequest:function(e){return e.file},headers:{"Content-Type":"application/octet-stream",Authorization:function(e){if(e.params&&e.params.token){var n="UpToken "+e.params.token;return delete e.params.token,n}}}}}]}).service("$api",["$rootScope","$resource","APICONFIG",function(e,n,t){var i=function(e,n){return/(^http:\/\/)|(^https:\/\/)/.test(e)&&e||[window.APIORIGIN+"/api/"+e,n?"/:_api_action":""].join("")},r=[];e.$on("$stateChangeStart",function(){angular.forEach(r,function(e){!e.$resolved&&e.$cancelRequest()}),r=[]}),angular.forEach(t,function(t,e){angular.isArray(t)&&t[0]&&(t[0]=i(t[0],!!t[2]),t[3]=angular.extend({cancellable:!0},t[3]),angular.forEach(t[2],function(e,n){e.url=e.url&&i(e.url)||void 0,e.method=e.method||"POST",e.params=e.params||{},e.params._api_action=e.url?void 0:n,window.isPRODUCTION||(e.headers=e.headers||{},e.headers["X-Cors-By"]="cloudenergy.me"),/api\.cloudenergy\.me/.test(e.url||t[0])&&angular.isUndefined(e.withCredentials)&&(e.withCredentials=!0)}),angular.forEach(this[e]=n.apply(n,t),function(t,e){this[e]=function(){var e,n;return angular.forEach([arguments[0],arguments[1]],function(e){angular.isObject(e)&&angular.isDefined(e._cancellable)&&(n=e._cancellable,delete e._cancellable)}),e=t.apply(this,arguments),!1===n&&delete e.$cancelRequest,e.$cancelRequest&&r.push(e),e}},this[e]))},this)}]).service("$loading",["$rootScope","$timeout",function(n,t){var i=this;angular.extend(i,{activities:0,inprogress:0,show:function(e){angular.isObject(e.params)&&(e._inprogress=e.params._inprogress,delete e.params._inprogress),angular.isObject(e.data)&&angular.isUndefined(e._inprogress)&&(e._inprogress=e.data._inprogress,delete e.data._inprogress),window.NetworkActivityIndicator&&(e._activities=t(function(){i.activities++,e._activities=i.activities,1===i.activities&&window.NetworkActivityIndicator.show()},60)),n.User.data&&(window.isPRODUCTION||window.isAndroid)&&!1!==e._inprogress&&(e._inprogress=t(function(){i.inprogress++,e._inprogress=i.inprogress,1===i.inprogress&&n.$broadcast("loading:show")},600))},hide:function(e){window.NetworkActivityIndicator&&(angular.isNumber(e._activities)?t(function(){i.activities--,0===i.activities&&window.NetworkActivityIndicator.hide()},600):angular.isObject(e._activities)&&t.cancel(e._activities),delete e._activities),(window.isPRODUCTION||window.isAndroid)&&!1!==e._inprogress&&(angular.isNumber(e._inprogress)?t(function(){i.inprogress--,0===i.inprogress&&n.$broadcast("loading:hide")},600):angular.isObject(e._inprogress)&&t.cancel(e._inprogress)),delete e._inprogress}})}]).config(["$qProvider","$httpProvider",function(e,n){e.errorOnUnhandledRejections(!1),n.interceptors.push(["$q","$location","$loading","$storage",function(n,t,i,r){return{request:function(e){return i.show(e),window.isPRODUCTION||!/\/api\//.test(e.url)||/\/api\/auth\/(login|logout)/.test(e.url)||(e.transformRequest=e.transformRequest.concat([function(e){return JSON.stringify(r.encrypt(JSON.parse(e||"{}")))}])),e},requestError:function(e){return n.reject(e)},response:function(e){return e.config&&i.hide(e.config),angular.isObject(e.data)&&(e.data.code||e.data.result&&angular.isObject(e.data.result)&&!Object.keys(e.data.result).length)?(/90000005|90000007/.test(e.data.code)&&t.url(window.isWECHAT?"/m/bind":"/m/login").replace(),n.reject(e.data)):e},responseError:function(e){return e.config&&i.hide(e.config),n.reject(e.data||{code:e.status})}}}])}]).run(["$rootScope","$ionicLoading",function(e,n){e.$on("loading:show",function(){n.show({template:'<ion-spinner icon="ripple" class="spinner-stable"></ion-spinner>',noBackdrop:!0})}),e.$on("loading:hide",function(){n.hide()})}]);
"use strict";angular.module("app").config(["$urlRouterProvider","$stateProvider",function(e,r){var o=window.isPRODUCTION?"/":"";e.otherwise(o),r.state("otherwise",{url:o,resolve:{rewrite:["$state",function(e){e.go("app.index",{},{location:"replace"})}]}}).state("app",{abstract:!0,url:"/m",templateUrl:"app/tabs.html?rev=57f9110750"}).state("app.welcome",{url:"/welcome",views:{"@":{templateUrl:"app/modules/welcome/welcome.html?rev=8f8228e420",controller:"app.welcome",controllerAs:"$ctrl"}},resolve:{deps:["$ocLazyLoad",function(e){return e.load("app/modules/welcome/welcome.min.js?rev=c28910cae2")}]}}).state("app.error",{url:"/error?{message}",views:{"@":{templateUrl:"app/modules/error/error.html?rev=0196350b07",controller:"app.error",controllerAs:"$ctrl"}},resolve:{deps:["$ocLazyLoad",function(e){return e.load("app/modules/error/error.min.js?rev=05d22f00d2")}]}}).state("app.login",{url:"/login",views:{"@":{templateUrl:"app/modules/login/login.html?rev=53b4e14866",controller:"app.login",controllerAs:"$ctrl"}},resolve:{login:["$ocLazyLoad",function(e){return e.load(["app/modules/login/login.min.css?rev=c7f15cf111","app/modules/login/login.min.js?rev=d9d0eeaaec"])}]}}).state("app.bind",{url:"/bind?{openid}&{platformid}&{target}&{force}",views:{"@":{templateUrl:"app/modules/bind/bind.html?rev=6524068a4c",controller:"app.bind",controllerAs:"$ctrl"}},resolve:{deps:["$state","$stateParams","$ocLazyLoad","$storage",function(e,r,o,a){return/1/.test(r.force)?a.set(null):a.get("token")&&e.go("app.index",{},{location:"replace"}),o.load(["app/modules/bind/bind.min.css?rev=9cb0519c32","app/modules/bind/bind.min.js?rev=0915b09d32"])}]}}).state("app.index",{url:"/index",views:{"view-index":{templateUrl:"app/modules/index/index.html?rev=a540e789d3",controller:"app.index",controllerAs:"$ctrl"}},resolve:{deps:["$ocLazyLoad",function(e){return e.load(["app/modules/index/index.min.css?rev=75194c0813","app/modules/index/index.min.js?rev=7fd2aa9179"])}]}}).state("app.device",{url:"/device",views:{"view-device":{templateUrl:"app/modules/device/device.html?rev=0284318dff",controller:"app.device",controllerAs:"$ctrl"}},resolve:{deps:["$ocLazyLoad",function(e){return e.load(["app/modules/device/device.min.css?rev=03cebc84fb","app/modules/device/device.min.js?rev=3e61748e9d"])}]}}).state("app.device_sensor",{url:"/device/sensor/:type/:id/:title",views:{"view-device":{templateUrl:"app/modules/device/sensor.html?rev=7d6d1da0c6",controller:"app.device_sensor",controllerAs:"$ctrl"}},resolve:{deps:["$ocLazyLoad",function(e){return e.load(["app/modules/device/sensor.min.css?rev=0ca88c2003","app/modules/device/sensor.min.js?rev=cfa0bf2083"])}]}}).state("app.device_month",{url:"/device/month/:month/:id",views:{"view-device":{templateUrl:"app/modules/device/month.html?rev=7d8b2c8c2c",controller:"app.device_month",controllerAs:"$ctrl"}},resolve:{deps:["$ocLazyLoad",function(e){return e.load(["app/components/highcharts.min.js?rev=e0109e803a","app/modules/device/month.min.js?rev=fb7239ed0c"])}]}}).state("app.fee",{url:"/fee",views:{"view-index":{templateUrl:"app/modules/fee/fee.html?rev=11a27414f4",controller:"app.fee",controllerAs:"$ctrl"}},resolve:{deps:["$ocLazyLoad",function(e){return e.load("app/modules/fee/fee.min.js?rev=386c9ce4ba")}]}}).state("app.recharge",{url:"/recharge",views:{"view-recharge":{templateUrl:"app/modules/recharge/recharge.html?rev=2a842a764a",controller:"app.recharge",controllerAs:"$ctrl"}},resolve:{deps:["$ocLazyLoad",function(e){return e.load(["app/modules/recharge/recharge.min.css?rev=0261c21de4","app/modules/recharge/recharge.min.js?rev=94a16ccf92"])}]}}).state("app.recharge_channel",{url:"/recharge/channel",params:{amount:{value:null}},views:{"view-recharge":{templateUrl:"app/modules/recharge/channel.html?rev=aeb0c50f9d",controller:"app.recharge_channel",controllerAs:"$ctrl"}},resolve:{deps:["$ocLazyLoad",function(e){var r=["app/modules/recharge/channel.min.js?rev=b8845daeb7"];return window.isWECHAT&&r.push("static/pingpp-js-2.1.13/pingpp.js"),e.load(r).then(function(){window.isWECHAT&&window.pingpp.setAPURL("static/pingpp-js-2.1.13/alipay_in_weixin/pay.htm")})}]}}).state("app.recharge_log",{url:"/recharge/log",views:{"view-recharge":{templateUrl:"app/modules/recharge/log.html?rev=630939f39f",controller:"app.recharge_log",controllerAs:"$ctrl"}},resolve:{deps:["$ocLazyLoad",function(e){return e.load("app/modules/recharge/log.min.js?rev=90e124ad1b")}]}}).state("app.account",{url:"/account",views:{"view-account":{templateUrl:"app/modules/account/account.html?rev=4137fe8fb7",controller:"app.account",controllerAs:"$ctrl"}},resolve:{deps:["$ocLazyLoad",function(e){return e.load(["app/modules/account/account.min.css?rev=92fa4ca21c","app/modules/account/account.min.js?rev=24f00d279b"])}]}}).state("app.notification",{url:"/notification",views:{"view-index":{templateUrl:"app/modules/notification/notification.html?rev=3c04b2b0ef",controller:"app.notification",controllerAs:"$ctrl"}},resolve:{deps:["$ocLazyLoad",function(e){return e.load(["app/modules/notification/notification.min.css?rev=b713b48e9a","app/modules/notification/notification.min.js?rev=6720a7334b"])}]}}).state("app.iframe",{url:"/iframe",params:{title:{value:null},target:{value:null}},views:{"view-index":{templateUrl:"app/modules/iframe/iframe.html?rev=ea2f8e37f2",controller:"app.iframe",controllerAs:"$ctrl"}},resolve:{deps:["$ocLazyLoad",function(e){return e.load("app/modules/iframe/iframe.min.js?rev=f58a7ba983")}]}})}]).run(["$rootScope","$state","$ionicLoading","User","ERRORCODE",function(e,l,t,n,c){e.$on("$stateChangeStart",function(e,r,o,a){angular.isUndefined(n.data)&&/^app\.(bind|login)$/.test(a.name)?e.preventDefault():/^otherwise$/.test(r.name)||(/^app\.welcome$/.test(r.name)||window.isPRODUCTION||localStorage.initialization||(e.preventDefault(),l.go("app.welcome",{},{location:"replace"})),!/^app\.(welcome|error|login|bind)$/.test(r.name)&&angular.isUndefined(n.data)&&(e.preventDefault(),n.$userinfo().then(function(){l.go(r.name,o,{location:"replace"})},function(e){/^90000009$/.test(e.code)&&(t.show({template:'<i class="ion-alert-circled"></i> '+c[e.code],duration:2e3}),n.$logout().then(function(){l.go("app.login",{},{location:"replace"})}))})))})}]);
"use strict";angular.module("app").constant("CATEGORY",{RECHARGING:{name:"充值",icon:"icon-app icon-recharge"},WITHDRAW:{name:"提现",icon:"icon-app icon-withdraw"},PAYFEES:{name:"缴费",icon:"icon-app icon-payment"},PAYPROPERTY:{name:"物业费",icon:"icon-app icon-property"},PAYPARKING:{name:"停车费",icon:"icon-app icon-parking"},HANDLINGCHARGE:{name:"手续费",icon:"icon-app icon-fee"},PAYELECTRICITY:{name:"电费",icon:"icon-app icon-electricity"},PAYCOLDWATER:{name:"冷水费",icon:"icon-app icon-cold-water"},PAYHOTWATER:{name:"热水费",icon:"icon-app icon-hot-water"},PAYACENERGY:{name:"空调费能量表",icon:"icon-app icon-energy"},PAYACPANEL:{name:"空调费面板",icon:"icon-app icon-air-conditioning"},HANDLINGCHARGERCG:{name:"充值服务费",icon:"icon-app icon-service-recharge"},HANDLINGCHARGEWTD:{name:"提现服务费",icon:"icon-app icon-service-withdraw"}}).constant("DEVICETYPE",{HEATENERGYMETER:{name:"热能表",channel:["07","08"],icon:"icon-app icon-energy positive"},DDWATERMETER:{name:"直饮水",channel:["02"],icon:"icon-app icon-cold-water calm"},TTYPETEMPCONTROL:{name:"T型温控器",channel:["33"],icon:"icon-app icon-temperature assertive"},ELECTRICITYMETER:{name:"电表",channel:["11"],icon:"icon-app icon-electricity energized"},HOTWATERMETER:{name:"热水表",channel:["03"],icon:"icon-app icon-hot-water assertive"},COLDWATERMETER:{name:"冷水表",channel:["01"],icon:"icon-app icon-cold-water calm"},ENERGYMETER:{name:"能量表",channel:["07","08"],icon:"icon-app icon-energy positive"},TEMPERATURECONTROL:{name:"温控器",channel:["33"],icon:"icon-app icon-temperature assertive"},TIMERMETER:{name:"时间采集器",channel:["07","08"],icon:"icon-app icon-time balanced"},PRESSUREMETER:{name:"压力表",channel:[],icon:""},ULTRACOLDWATERMETER:{name:"超声波水表",channel:["04"],icon:""}});
"use strict";angular.module("app").constant("ERRORCODE",{20000001:"用户不存在",20000003:"参数不全",90000001:"服务器错误",90000002:"拒绝访问",90000003:"登录失败",90000004:"权限不足",90000005:"未登录",90000006:"身份验证失败",90000007:"签名校验失败",90000009:"请使用商户帐号",pingpp_fail:"支付失败",pingpp_cancel:"取消支付"});
"use strict";angular.module("app").filter("deviceMeter",["DEVICETYPE",function(e){return function(n,r){return e[n]&&e[n][r]||""}}]).filter("deviceChannelScale",["DEVICETYPE",function(t){return function(r,n,e){var u=[];return t[n]&&angular.forEach(t[n][e]||[],function(n){r[n]&&u.push(r[n])}),u}}]).filter("deviceSensorPercent",function(){return function(n,r){var e=0,u=0;return angular.forEach(n,function(n){e+=n.sum,u+=n[r]}),e?100*u/e:0}}).filter("deviceSensorSum",function(){return function(n,r){var e=0;return angular.forEach(n,function(n){e+=r?Number(n[r]):n}),e}});
"use strict";angular.module("app").run(["$ionicPlatform","$ionicPopup","$state","$storage",function(e,o,t,n){e.on("resume",function(){window.chcp?chcp.fetchUpdate(function(e){e?!n.expired()&&t.reload():(navigator.splashscreen.show(),chcp.installUpdate())}):!n.expired()&&t.reload()}),["chcp_nothingToUpdate","chcp_updateInstalled","chcp_updateInstallFailed","chcp_updateLoadFailed"].forEach(function(e){document.addEventListener(e,function(){setTimeout(function(){navigator.splashscreen.hide()},1666.66)},!1)}),document.addEventListener("chcp_updateLoadFailed",function(e){var t=e.detail.error;t&&t.code==chcp.error.APPLICATION_BUILD_VERSION_TOO_LOW&&(o.show({cssClass:"text-center",title:"升级提醒",template:"有新的版本，请下载更新",buttons:[{text:"立即升级",type:"button-positive",onTap:function(e){e.preventDefault(),window.isIOS?window.open("itms-apps://itunes.apple.com/cn/app/id1237120322?timestamp="+(new Date).valueOf()):window.isAndroid&&cordova.InAppBrowser.open("http://zft.gugecc.com/zft-app.html","_system")}}]}),["mousedown","mousemove","mouseup","MSPointerDown","MSPointerMove","MSPointerUp","pointerdown","pointermove","pointerup","touchstart","touchmove","touchend"].forEach(function(e){document.querySelector("body>ion-nav-view").addEventListener(e,function(e){return e.preventDefault(),e.stopPropagation(),!1},!0)}))},!1)}]);
"use strict";angular.module("app").factory("$exceptionHandler",["$fundebug",function(t){return t.init(),t.notifyError}]).service("$fundebug",function(){var e=[];window.isWECHAT&&e.push("wechat"),!window.isPRODUCTION&&e.push(window.ionic.Platform.platform()),e.push(/preapi/.test(window.APIORIGIN)?"release":"production"),this.init=function(){var t=document.createElement("script");t.src="https://og6593g2z.qnssl.com/fundebug.0.3.3.min.js",t.setAttribute("apikey","fe08d4a9898c7df8f3e425aab0e7cc7a9283718478632fd3b280ceaf3a204df4"),t.setAttribute("releasestage",e.join("-")),window.AppVersion&&t.setAttribute("appversion",AppVersion.version),t.onload=t.onreadystatechange=function(){t.readyState&&!/^c|loade/.test(t.readyState)||(t.onload=t.onreadystatechange=null,fundebug.filters=[{req:{method:/^GET$/,url:/^(\/var\/|app\/|data:text\/html|file:\/\/\/|https:\/\/(pre)?app\.)/},res:{status:/^0$/}},{req:{method:/^POST$/,url:/^https:\/\/(pre)?api\./},res:{status:/^0$/}}])},document.body.appendChild(t)},this.metaData=function(t){fundebug.metaData=angular.extend(fundebug.metaData||{},t)},this.notifyError=function(t){fundebug.notifyError(t)}});
"use strict";angular.module("app").run(["$ionicPlatform","$jpush","$message",function(n,i,e){var o,t,a=!0,c=function(){o=t?void 0:setTimeout(function(){o=void 0,e.check()},1666.66)},u=function(){t=o?void 0:setTimeout(function(){t=void 0,e.check()},1666.66)};window.isPRODUCTION?c():(n.on("resume",function(){c(),i.clearAndroid(),i.clearIOS(),a=!0}),n.on("pause",function(){a=!1}),document.addEventListener("jpush.openNotification",function(){u(),i.clearAndroid(),i.clearIOS()},!1),document.addEventListener("jpush.receiveNotification",function(){u(),a&&(i.clearAndroid(),i.clearIOS())},!1))}]).service("$jpush",["$storage",function(n){if(!window.isPRODUCTION){var o,e=this;angular.extend(e,{clearAndroid:function(){setTimeout(function(){o.clearAllNotification()},1666.66)},clearIOS:function(){setTimeout(function(){o.resetBadge(),o.setApplicationIconBadgeNumber(0)},1666.66)},setAlias:function(n,i,e){o.setAlias(angular.isNumber(n)?n.toString():n,i||angular.noop,e||angular.noop)}}),(o=window.plugins&&window.plugins.jPushPlugin).init(),e.clearAndroid(),e.clearIOS(),!n.expired()&&o.getRegistrationID(function n(i){i?localStorage.JPUSH_ALIAS&&e.setAlias(localStorage.JPUSH_ALIAS):setTimeout(function(){o.getRegistrationID(n)},5e3)})}}]);
"use strict";angular.module("app").service("$message",["$rootScope","$q","$ionicPopup","$state","$api",function(o,t,i,n,a){var l,c,r=this;angular.extend(r,{list:function(e){return o.User.data?(l="UNREADMESSAGE_"+o.User.data.uid+"_"+o.User.data.project,a.message.list(angular.extend(e||{},{uid:o.User.data.uid,projectid:o.User.data.project})).$promise):t.reject()},readed:function(e){return a.message.readed(e,function(){r.clearStorage(e)}).$promise},delete:function(e){return a.message.delete(e,function(){r.clearStorage(e)}).$promise},clearStorage:function(e){e.id&&(localStorage[l]=(localStorage[l]||"").replace(","+e.id+",",",").replace(","+e.id,"").replace(e.id+",","").replace(e.id,""),localStorage[l]||(e.all=!0)),e.all&&(delete o.UNREADMESSAGE,delete localStorage[l])},check:function(){r.list({unread:1,pagesize:60}).then(function(e){o.UNREADMESSAGE=e&&e.result&&e.result.detail||[];var t=localStorage[l]||"",a=t?t.split(","):[],r=[];angular.forEach(o.UNREADMESSAGE,function(e){!~a.indexOf(e.id)&&r.push(e.id)}),(a=a.concat(r)).length?localStorage[l]=a.join():delete localStorage[l],!c&&r.length&&(c=i.confirm({title:"通知提醒",template:"收到最新通知，是否立即查看？",cancelText:"稍后",okText:"查看"}).then(function(e){c=void 0,e&&("app.notification"===n.current.name?o.$broadcast("app.notification:refresh"):n.go("app.notification"))}))})}})}]);
"use strict";angular.module("app").service("$storage",["$cookies",function(o){var a=this,i="__emapp_",r={1:"APP_ANDROID",2:"APP_IOS",3:"WEB",4:"WECHAT"}[(window.isWECHAT?4:window.isAndroid&&1)||window.isIOS&&2||3],s=window.isPRODUCTION?".cloudenergy.me":location.hostname,c={uid:"",token:"",client:r},e=o.getAll(),d=new window.Hashes.SHA1;angular.extend(a,{get:function(e){return"undefined"===(e=a.expired()?void 0:o.get(e)||sessionStorage[i+e]||localStorage[i+e])?void 0:e},set:function(t,n,e){t&&Object.keys(t).length?(t.client=r,!e&&Object.keys(c).map(function(e){o.put(e,t[e],{path:"/",domain:s,expires:n&&moment().add(10,"Y")._d||void 0})}),n?(a.expired(moment().add(10,"Y").unix()),Object.keys(c).map(function(e){localStorage[i+e]=t[e]})):(sessionStorage[i+"expires"]="Session",Object.keys(c).map(function(e){sessionStorage[i+e]=t[e]}))):(delete localStorage[i+"expires"],delete sessionStorage[i+"expires"],Object.keys(c).map(function(e){delete localStorage[i+e],delete sessionStorage[i+e],o.remove(e,{path:"/",domain:s})}))},expired:function(e){if(!e||!moment(e,"X"))return!o.get("token")&&(!sessionStorage[i+"expires"]&&(!(e=localStorage[i+"expires"])||moment(e,"X").isBefore(moment())));localStorage[i+"expires"]=e},valid:function(){var t=!0;return Object.keys(c).map(function(e){a.get(e)||(t=!1)}),t},encrypt:function(e){if(a.valid()){var t=moment().unix();e.client=r,e.v=t,e.t=a.get("token"),e.sign=d.hex((n=e,o=d.hex(t.toString()),i=[],s=[],angular.forEach(n,function(e,t){i.push(t)}),i.sort(),angular.forEach(i,function(e){s.push(e+"="+encodeURIComponent(angular.isObject(n[e])?JSON.stringify(n[e]):n[e]))}),o+s.toString().replace(/,/g,"")+o)),e.p=a.get("uid"),delete e.t}var n,o,i,s;return e}}),Object.keys(e).length&&a.set(e,!1,!0)}]);
"use strict";angular.module("app").service("User",["$rootScope","$q","$api","$fundebug","$jpush","$message","$storage",function(r,s,n,u,o,l,a){angular.extend(r.User=this,{data:void 0,$userinfo:function(e){var t=s.defer();return n.business.userinfo(e||{},function(e){/^USER$/.test(e.result.character._id)?(r.User.data=angular.extend({},e.result),delete e.result.character.rule,u.metaData({userinfo:e.result}),t.resolve(e)):(a.set(null),t.reject({code:90000009}))},function(e){a.set(null),t.reject(e)}),t.promise},$login:function(e){var t=s.defer();return n.auth.login(e||{},function(e){a.set(e.result,!0),r.User.$userinfo().then(function(e){!window.isPRODUCTION&&o.setAlias(localStorage.JPUSH_ALIAS=e.result.userid),l.check(),t.resolve(e)},function(e){a.set(null),t.reject(e)})},t.reject),t.promise},$logout:function(e){return n.auth.logout(e||{},function(){delete r.User.data,delete localStorage.JPUSH_ALIAS,a.set(null),!window.isPRODUCTION&&o.setAlias("")}).$promise}})}]);